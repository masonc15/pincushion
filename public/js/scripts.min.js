!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){function _typeof(o){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}var url_params,submit_error_timer,field_error_timer,bookmark,existingTags,submission_block_timer,API_ENDPOINT,GPT_TEMPERATURE,Ladda=((e,r)=>{if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{default:e};if((r=_getRequireWildcardCache(r))&&r.has(e))return r.get(e);var u,i,n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(u in e)"default"!==u&&{}.hasOwnProperty.call(e,u)&&((i=a?Object.getOwnPropertyDescriptor(e,u):null)&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u]);return n.default=e,r&&r.set(e,n),n})(require("ladda")),_openai=(require=require("openai"))&&require.__esModule?require:{default:require};function _getRequireWildcardCache(e){var r,t;return"function"!=typeof WeakMap?null:(r=new WeakMap,t=new WeakMap,(_getRequireWildcardCache=function(e){return e?t:r})(e))}function _regeneratorRuntime(){_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}function wrap(t,e,r,n){e=e&&e.prototype instanceof Generator?e:Generator,e=Object.create(e.prototype),n=new Context(n||[]);return o(e,"_invoke",{value:makeInvokeMethod(t,r,n)}),e}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var i={},d=(define(i,a,function(){return this}),Object.getPrototypeOf),d=d&&d(d(values([]))),g=(d&&d!==r&&n.call(d,a)&&(i=d),GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(i));function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var u,r=tryCatch(t[r],t,o);if("throw"!==r.type)return(o=(u=r.arg).value)&&"object"==_typeof(o)&&n.call(o,"__await")?e.resolve(o.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(o).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)});a(r.arg)}var r;o(this,"_invoke",{value:function(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){c=function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;n=tryCatch(o,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,y;o=n.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}(c,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;c=tryCatch(e,r,n);if("normal"===c.type){if(o=n.done?s:l,c.arg===y)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=s,n.method="throw",n.arg=c.arg)}}}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var o,r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return o=-1,(r=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next}).next=r}throw new TypeError(_typeof(e)+" is not iterable")}return o(g,"constructor",{value:GeneratorFunction.prototype=GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var n,e=Object(t),r=[];for(n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;0<=o;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}var a=(i=i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc?null:i)?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,o,r=this.tryEntries[e];if(r.tryLoc===t)return"throw"===(n=r.completion).type&&(o=n.arg,resetTryEntry(r)),o}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function display_critical_error(message){alert(message),$(".helptext").remove(),$("#submit").addClass("fail"),$("#submit").prop("disabled",!0),$("#mainspinner").addClass("hidden")}function auth_token(){return url_params.user+":"+url_params.token}function showBookmarkTimestamp(date){$("#bookmark-status").attr("title",moment(date).format("dddd, MMMM Do YYYY, h:mma")).text("Originally saved "+moment(date).fromNow())}function leave_a_gap(){$("textarea#description").val($.trim($("textarea#description").val())),""!==$("textarea#description").val()&&($("textarea#description").val($("textarea#description").val()+"\n\n"),$("textarea#description").animate({scrollTop:"800"},1e3))}function remove_error_state_after_delay(){clearTimeout(submit_error_timer),clearTimeout(field_error_timer),submit_error_timer=setTimeout(function(){$("#submit").removeClass("fail"),$("#submit span.text").text($("#submit").data("stateText"))},1500),field_error_timer=setTimeout(function(){$("label span.helptext").fadeOut(300,function(){$(this).remove(),$("label").removeClass("error")})},2900)}function populate_dropdown(){var user_tags;localStorage&&localStorage.tags&&(user_tags=JSON.parse(localStorage.tags),console.log("Populating dropdown with "+Object.keys(user_tags).length.toLocaleString()+" tags."),$.each(user_tags,function(key,value){$("input#tags")[0].selectize.addOption({label:key,normalised_label:key.replace(/[&-_\[\]#,+()$~%.'":*?<>{}]/g,""),count:value})}))}function add_tag_remove_button_handlers(selector){selector.on("click",function(event){event.preventDefault(),event=$(this).text(),event=event=(event=(event=event.replace(/\\/g,"\\\\")).replace(/'/g,"\\'")).replace(/"/g,"&quot;"),$("input#tags")[0].selectize.addOption({label:event}),$("input#tags")[0].selectize.addItem(event),$(this).hide(100,function(){$(this).remove(),remove_suggested_tag_separator(),check_if_suggested_tags_are_empty()})})}function check_if_suggested_tags_are_empty(){remove_suggested_tag_separator(),0===$("#suggestion_row th").length&&($("#suggestion_row th").hide(300),$("#suggested").addClass("none").text("No suggested tags for this page."))}function activate_suggested_tags(){remove_suggested_tag_separator(),0===$("#suggested button").length&&$("#suggested").removeClass("none").text(""),$("#suggestion_row th").text("suggested tags")}function append_suggested_tag(tag){activate_suggested_tags(),$("#suggested").prepend('<button type="button" class="suggested_tag">'+pin_cook(tag)+"</button>"),add_tag_remove_button_handlers($("#suggested button:first"))}function remove_suggested_tag_separator(){0<$("#suggested").children().length&&("HR"===$("#suggested").children(":visible").first()[0].tagName||"HR"===$("#suggested").children(":visible").last()[0].tagName)&&$("#suggested hr").hide(200,function(){$(this).remove()}),0===$("#suggested button").length&&($("#suggestion_row th").hide(300),$("#suggested").addClass("none").text("No more suggested tags for this page."))}function display_reload_button(){$("#mainspinner").replaceWith('<button id="reload"><i class="fa fa-repeat"></i></button>'),$("#reload").click(function(event){event.preventDefault(),$(this).addClass("active"),window.location.reload()})}function download_user_tags(){console.log("Downloading user’s tags...");var all_tags_api=API_ENDPOINT+"tags/get?format=json&auth_token="+auth_token();$.get(all_tags_api).done(function(response){localStorage.tags=JSON.stringify(response),localStorage["tags-updated"]=new Date,console.log("Downloaded tags."),populate_dropdown()}).fail(function(response){401===response.status&&display_critical_error("401 Unauthorised. Please check the username and API access token you provided.")})}function pin_cook(s){return s=(s=(s=(s=s.replace(/^\s+|\s+$/g,"")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")}function clean_url(url){return url=url.replace(/#.*$/,""),encodeURIComponent(url)}function queryGPTForTags(){return _queryGPTForTags.apply(this,arguments)}function _queryGPTForTags(){var n;return n=_regeneratorRuntime().mark(function _callee(){var completion,openai,contextInputs;return _regeneratorRuntime().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(url_params.openai_token){_context.next=2;break}return _context.abrupt("return");case 2:return openai=new _openai.default({apiKey:url_params.openai_token,dangerouslyAllowBrowser:!0}),existingTags=bookmark?bookmark.tags:"",contextInputs={url:url_params.url,title:url_params.title,description:url_params.description,existingTags:existingTags},_context.next=8,openai.chat.completions.create({model:"gpt-4o",max_tokens:250,temperature:GPT_TEMPERATURE,messages:[{role:"system",content:"Return a comma-separated list containing suggested tags to use for bookmarking a page on the web. You will be provided an URL, and sometimes a title, a description or snippet from the page, and list of existing tags.  The format of your response should be a comma-separated list, for example: spying, russia, 1980s, nuclear_war, cold_war, history\nThe tags you suggest should all be in lowercase, with no surrounding whitespace. Use underscores instead of spaces to combine words if necessary. Avoid punctuation marks.\nThink of the key concepts, people, subjects, brands, years/decades, publishers, websites, related concepts, etc. that are likely to be relevant to the page. Think of related or alternative concepts so you're not locked into a single meaning or interpretation. Don't over-emphasise the content of the description field, as this may just be a single paragraph or user comment from the page. There should be up to 14 tags, but only include ones that you are sure are relevant. Aim for at least 6. If you can't think of any tags, return an empty array. Remove any duplicate tags, or ones that are already present in the list of existing tags (the existingTags field). Finally, sort the tags and return them in ascending order of relevance."},{role:"user",content:"Here are my inputs: "+JSON.stringify(contextInputs)},{role:"assistant",content:"Here are my tag suggestions: "}]});case 8:if(0===(completion=_context.sent).choices.length)return _context.abrupt("return");_context.next=11;break;case 11:return openai=completion.choices[0].message.content,(contextInputs=openai.replace(/^\s+|\s+$/g,"")).endsWith(",")&&(contextInputs=contextInputs.slice(0,-1)),contextInputs.split(",").forEach(function(suggested_tag){append_suggested_tag(suggested_tag)}),_context.abrupt("return",openai);case 17:case"end":return _context.stop()}},_callee)}),(_queryGPTForTags=function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}).apply(this,arguments)}submission_block_timer=!1,API_ENDPOINT="https://eloquent-fenglisu-ae6d4c.netlify.app/.netlify/functions/pinboard-bridge/",GPT_TEMPERATURE=.4,$(function(){var bookmark_details_api;window.outerHeight<750&&window.resizeTo(600,750),$(document).keydown(function(e){(e=>{27===e.keyCode&&window.close()})(e)}),(window.onpopstate=function(){function decode(s){return decodeURIComponent(s.replace(pl," "))}var match,pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,query=window.location.search.substring(1);for(url_params={};match=search.exec(query);)url_params[decode(match[1])]=decode(match[2])})(),url_params.url&&-1!==url_params.url.indexOf("#")&&($("input#url").addClass("hash-detected"),setTimeout(function(){$("input#url").after('<button id="remove-hash" class="fa fa-hashtag" title="Remove hash from URL"></button>'),$("#remove-hash").click(function(event){event.preventDefault(),$("input#url").val($("input#url").val().replace(/#.*$/,"")),$(this).slideUp(200),setTimeout(function(){$("input#url").removeClass("hash-detected")},200)})},300)),$("input#url").val(url_params.url),$("input#title").val((title_string=>title_string?title_string.replace(/^▶ /,""):"")(url_params.title)),$("textarea#description").val($.trim(url_params.description)),$("input#private").prop("checked","true"===url_params.private),$("input#toread").prop("checked","true"===url_params.private),leave_a_gap(),url_params.user&&url_params.token||display_critical_error("You must provide both ‘user’ and ‘token’ parameters to this page to allow it to use the Pinboard API."),$("input#tags").selectize({delimiter:" ",create:!0,openOnFocus:!1,maxOptions:15,persist:!0,createOnBlur:!1,hideSelected:!0,selectOnTab:!1,diacritics:!0,valueField:"label",labelField:"label",searchField:["label","normalised_label"],score:function(search){var score=this.getScoreFunction(search);return function(item){return score(item)*(1+item.count/100)}},plugins:{remove_button:{title:"Remove this tag"}},onEnterKeypress:function(){!1===submission_block_timer&&$("#submit").click()},onChange:function(){$("input#tags")[0].selectize.close(),submission_block_timer=!0,setTimeout(function(){submission_block_timer=!1},10)},onItemAdd:function(value,$item){$(".suggested_tag").each(function(){$(this).text()===value&&$(this).hide(400,function(){$(this).remove(),remove_suggested_tag_separator()})}),$("input#tags")[0].selectize.close()},onItemRemove:function(value,$item){append_suggested_tag(value)},render:{option:function(data,escape){var count=void 0!==data.count?escape(data.count):"0";return'\n            <div class="item">\n              '.concat(escape(data.label),'\n              <span class="optioncount ').concat((count=>{switch(!0){case 100<count:return"tw100";case 50<count:return"tw50";case 10<count:return"tw10";case 1<count:return"tw1"}})(escape(data.count)),'">\n                ').concat(count,"\n              </span>\n            </div>")}}}),populate_dropdown(),$("#post-to-pinboard").on("submit",function(event){event.preventDefault(),$("#submit span.text").html("Saving bookmark&hellip;");event=API_ENDPOINT+"posts/add?format=json&auth_token="+auth_token()+"&"+(()=>{$("#description").val($.trim($("#description").val()));var serialized_form_inputs=$("#url, #title, #description, #tags").serialize();return $("#private").prop("checked")&&(serialized_form_inputs+="&shared=no"),$("#toread").prop("checked")&&(serialized_form_inputs+="&toread=yes"),serialized_form_inputs})();$.ajax({type:"GET",url:event,timeout:25e3}).done(function(response){if("done"===response.result_code){console.log("Bookmark saved correctly."),Ladda.stopAll(),$("#submit").addClass("success"),$("#submit span.text").text("Bookmark saved!");for(var user_tags=JSON.parse(localStorage.tags),potentially_new_tags=$("input#tags").val().split(" "),i=0;i<potentially_new_tags.length;i++)user_tags[potentially_new_tags[i]]?$("input#tags").data("previous_tags")&&-1!==$("input#tags").data("previous_tags").indexOf(potentially_new_tags[i])||(user_tags[potentially_new_tags[i]]=parseInt(user_tags[potentially_new_tags[i]])+1):user_tags[potentially_new_tags[i]]=1;localStorage.tags=JSON.stringify(user_tags),localStorage["tags-updated"]=new Date,setTimeout(function(){window.close(),setTimeout(function(){$("#submit").removeClass("success"),$("#submit span.text").text($("#submit").data("stateText")),showBookmarkTimestamp(new Date)},300)},900)}else Ladda.stopAll(),$(".helptext").remove(),$("#submit").addClass("fail"),"missing url"===response.result_code&&($("label[for=url]").addClass("error").append('<span class="helptext"> is required</span>'),$("#url").focus()),"must provide title"===response.result_code&&($("label[for=title]").addClass("error").append('<span class="helptext"> is required</span>'),$("#title").focus()),$(".helptext").fadeIn(),remove_error_state_after_delay()}).fail(function(response){Ladda.stopAll(),$(".helptext").remove(),$("#submit").addClass("fail"),0===response.status&&"error"===response.statusText&&(alert("Cross-domain request failed. Your connection may have dropped, or the request may be too long; please try shortening the description text."),display_reload_button()),414===response.status&&($("label[for=description]").addClass("error").append('<span class="helptext"> is too long</span>'),$("#description").addClass("expanded"),$("#description").focus()),401===response.status&&display_critical_error("401 Unauthorised. Please check the username and API access token you provided."),$(".helptext").fadeIn(),remove_error_state_after_delay()})}),$("input, textarea").on("blur",function(){$("body").animate({scrollTop:0},200)}),"ontouchstart"in window||$("input#tags")[0].selectize.focus(),$("textarea#description").on("blur",function(){leave_a_gap()}),$("#private").on("change",function(){!0===$("#private").prop("checked")?$("body").addClass("private"):$("body").removeClass("private")}),Ladda.bind("button[type=submit]"),url_params.url&&(bookmark_details_api=API_ENDPOINT+"posts/get?format=json&auth_token="+auth_token()+"&url="+clean_url(url_params.url),$.support.cors=!0,$.get(bookmark_details_api).done(function(response){if($("#mainspinner").addClass("hidden"),$("#submit").data("stateText","Add bookmark"),1!==response.posts.length)queryGPTForTags().then(console.log).catch(console.error);else{bookmark=response.posts[0],queryGPTForTags().then(console.log).catch(console.error),$("input#title").val(bookmark.description),bookmark.extended&&$.trim(bookmark.extended)!==$.trim(url_params.description)&&$("textarea#description").val($.trim(bookmark.extended)+"\n\n"+$.trim(url_params.description)),leave_a_gap();response=bookmark.tags;if(""!=response){$("input#tags").data("previous_tags",response);for(var tags=response.split(" "),i=0;i<tags.length;i++)$("input#tags")[0].selectize.addOption({label:tags[i]}),$("input#tags")[0].selectize.addItem(tags[i]),$("input#tags")[0].selectize.close();$("#suggested button").filter(function(){return $(this).text().toLowerCase()===tags[i]}).remove()}"no"===bookmark.shared?$("#private").prop("checked",!0).change():$("#private").prop("checked",!1),"yes"===bookmark.toread?$("#toread").prop("checked",!0):$("#toread").prop("checked",!1),bookmark.time&&showBookmarkTimestamp(new Date(bookmark.time)),$("#submit").data("stateText","Update bookmark"),$("#submit span.text").text("Update bookmark")}}).fail(function(response){0===response.status&&(response.statusText,1)&&(display_critical_error("Cross-domain request failed. Your browser is denying this request from being sent."),display_reload_button()),401===response.status&&display_critical_error("401 Unauthorised. Please check the username and API access token you provided.")})),url_params.url&&(bookmark_details_api=API_ENDPOINT+"posts/suggest?format=json&auth_token="+auth_token()+"&url="+clean_url(url_params.url),$("#tagspinner").removeClass("hidden"),$.get(bookmark_details_api).done(function(response){var tag_suggestions=response;if(tag_suggestions){tag_suggestions=(tag_suggestions=$.merge(tag_suggestions[1].recommended,tag_suggestions[0].popular)).map(function(tag){return tag.toLowerCase()}),tag_suggestions=(tag_suggestions=>{var ranked_tags,user_tags,separator;return localStorage&&localStorage.tags?(ranked_tags=[],user_tags=JSON.parse(localStorage.tags),separator=!0,$.each(tag_suggestions,function(index,tag){user_tags.hasOwnProperty(tag)?(separator&&(ranked_tags.unshift("$separator"),separator=!1),ranked_tags.unshift(tag)):ranked_tags.push(tag)}),ranked_tags):tag_suggestions})(tag_suggestions=(tag_suggestions=>{var ignored_tags=["bookmarks_bar","pin-later","unread","*resources","unlabeled","via:packrati.us","bookmarks_menu",".from:twitter","twitterlink","from","ifttt","later","saved","read","feedly","for","recently","tobookmarks","from:ifttt","instapaper","!fromtwitter","feedbin","favorites_bar","imported",".dailybrowse","barra_dei_preferiti","bookmarks_toolbar","via:pocket","from_pocket","pocket","archive","toread","readlater","via:popular","!tweet","twitter-fav","created-by:ifttt","starred","soon","riposte","github:starred","iftttfeedly","github-starred-to-pinboard","appdotnet","top","instapaper:","&amp;","(popular","--","bookmarks)","from:feedly","from:rss","instapaper:import","instapaper:starred","*","**","***","instapaper:import","googlereader","no_tag","evernote-web-clipper"];return tag_suggestions=$.grep(tag_suggestions,function(tag){return-1===$.inArray(tag.toLowerCase(),ignored_tags)}),tag_suggestions=$.grep(tag_suggestions,function(tag){return null===tag.toLowerCase().match(/^via:/)})})(tag_suggestions=(tag_suggestions=>["ifttt","facebook","youtube","objective-c","twitter","twitterlink","wsh",".from:twitter","@codepo8","1960s"].every(function(tag){return tag_suggestions.includes(tag)})?[]:tag_suggestions)(tag_suggestions=$.grep(tag_suggestions,function(v,k){return $.inArray(v,tag_suggestions)===k}))));for(var suggested_tags=[],i=0;i<tag_suggestions.length;i++)"$separator"===tag_suggestions[i]?suggested_tags.push("<hr>"):-1===(" "+$("#tags").val().toLowerCase()+" ").indexOf(" "+tag_suggestions[i]+" ")&&suggested_tags.push('<button type="button" class="suggested_tag">'+pin_cook(tag_suggestions[i])+"</button>");(0<suggested_tags.length?($("#suggested").append(suggested_tags.join("")),add_tag_remove_button_handlers($("#suggested button")),activate_suggested_tags(),remove_suggested_tag_separator):check_if_suggested_tags_are_empty)()}$("#tagspinner").addClass("hidden")}).fail(function(response){$("#suggestion_row th").hide(800),$("#tagspinner").hide(300)})),localStorage&&(localStorage.tags?(console.log("Have a record of tags already, setting up delayed download."),setTimeout(function(){download_user_tags()},1e4)):download_user_tags())}),RegExp.escape=function(text){return text.replace(/[-[\]{}()*+?.,\\\\'"^$|#\s]/g,"\\$&")}},{ladda:5,openai:14}],2:[function(require,module,exports){exports.byteLength=function(b64){var b64=getLens(b64),validLen=b64[0],b64=b64[1];return 3*(validLen+b64)/4-b64},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],lens=lens[1],arr=new Arr(((validLen,placeHoldersLen)=>3*(validLen+placeHoldersLen)/4-placeHoldersLen)(validLen,lens)),curByte=0,len=0<lens?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===lens&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===lens&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(((uint8,start,end)=>{for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push((num=>lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num])(tmp));return output.join("")})(uint8,i,len2<i+16383?len2:i+16383));1==extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2==extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(0<len%4)throw new Error("Invalid string. Length must be a multiple of 4");b64=b64.indexOf("="),len=(b64=-1===b64?len:b64)===len?0:4-b64%4;return[b64,len]}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],3:[function(require,module,exports){!function(Buffer){!function(){var base64=require("base64-js"),ieee754=require("ieee754"),K_MAX_LENGTH=(exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,2147483647);function createBuffer(length){if(K_MAX_LENGTH<length)throw new RangeError('The value "'+length+'" is invalid for option "size"');length=new Uint8Array(length);return length.__proto__=Buffer.prototype,length}function Buffer(arg,encodingOrOffset,length){if("number"!=typeof arg)return from(arg,encodingOrOffset,length);if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}function from(value,encodingOrOffset,length){if("string"==typeof value)return((string,encoding)=>{var length,buf;if(Buffer.isEncoding(encoding="string"==typeof encoding&&""!==encoding?encoding:"utf8"))return length=0|byteLength(string,encoding),buf=createBuffer(length),buf=(string=buf.write(string,encoding))!==length?buf.slice(0,string):buf;throw new TypeError("Unknown encoding: "+encoding)})(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return((array,byteOffset,length)=>{if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');return(array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length)).__proto__=Buffer.prototype,array})(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);valueOf=(obj=>{var len,buf;return Buffer.isBuffer(obj)?(len=0|checked(obj.length),0!==(buf=createBuffer(len)).length&&obj.copy(buf,0,0,len),buf):void 0!==obj.length?"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj):"Buffer"===obj.type&&Array.isArray(obj.data)?fromArrayLike(obj.data):void 0})(value);if(valueOf)return valueOf;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(K_MAX_LENGTH<=length)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=2<arguments.length&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((start=void 0===start||start<0?0:start)>this.length)return"";if((end=void 0===end||end>this.length?this.length:end)<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding=encoding||"utf8";;)switch(encoding){case"hex":return((buf,start,end)=>{var len=buf.length;(!end||end<0||len<end)&&(end=len);for(var out="",i=start=!start||start<0?0:start;i<end;++i)out+=(n=>n<16?"0"+n.toString(16):n.toString(16))(buf[i]);return out})(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return((buf,start,end)=>{var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret})(this,start,end);case"latin1":case"binary":return((buf,start,end)=>{var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret})(this,start,end);case"base64":return((buf,start,end)=>0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end)))(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return((buf,start,end)=>{for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res})(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):2147483647<byteOffset?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),(byteOffset=numberIsNaN(byteOffset=+byteOffset)?dir?0:buffer.length-1:byteOffset)<0&&(byteOffset=buffer.length+byteOffset),buffer.length<=byteOffset){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?(dir?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;arrLength/=indexSize=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir)for(var foundIndex=-1,i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(i-(foundIndex=-1===foundIndex?i:foundIndex)+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1;else for(i=byteOffset=arrLength<byteOffset+valLength?arrLength-valLength:byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function asciiWrite(buf,string,offset,length){return blitBuffer((str=>{for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray})(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(((str,units)=>{for(var c,hi,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,byteArray.push(c%256),byteArray.push(hi);return byteArray})(string,buf.length-offset),buf,offset,length)}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&127<(tempCodePoint=(31&firstByte)<<6|63&secondByte)&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&2047<(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)&&(tempCodePoint<55296||57343<tempCodePoint)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&65535<(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):65535<codePoint&&(res.push((codePoint-=65536)>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return(codePoints=>{var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res})(res)}exports.kMaxLength=K_MAX_LENGTH,(Buffer.TYPED_ARRAY_SUPPORT=(()=>{try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}})())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=from,Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return((size,fill,encoding)=>(assertSize(size),!(size<=0)&&void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)))(size,fill,encoding)},Buffer.allocUnsafe=allocUnsafe,Buffer.allocUnsafeSlow=allocUnsafe,Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=Buffer.allocUnsafe(length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toLocaleString=Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(Buffer.isBuffer(b))return this===b||0===Buffer.compare(this,b);throw new TypeError("Argument must be a Buffer")},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES,str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();return this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),(start=void 0===start?0:start)<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisEnd<=thisStart&&end<=start)return 0;if(thisEnd<=thisStart)return-1;if(end<=start)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding=encoding||"utf8";for(var loweredCase=!1;;)switch(encoding){case"hex":return((buf,string,offset,length)=>{offset=Number(offset)||0;var remaining=buf.length-offset;(!length||remaining<(length=Number(length)))&&(length=remaining),(remaining=string.length)/2<length&&(length=remaining/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i})(this,string,offset,length);case"utf8":case"utf-8":return((buf,string,offset,length)=>blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length))(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return((buf,string,offset,length)=>blitBuffer(base64ToBytes(string),buf,offset,length))(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(length<offset+ext)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(max<value||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var len=this.length,len=((start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):len<end&&(end=len),end<start&&(end=start),this.subarray(start,end));return len.__proto__=Buffer.prototype,len},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;0<byteLength&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];0<i&&(mul*=256);)val+=this[offset+--i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);noAssert=this[offset]|this[offset+1]<<8;return 32768&noAssert?4294901760|noAssert:noAssert},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);noAssert=this[offset+1]|this[offset]<<8;return 32768&noAssert?4294901760|noAssert:noAssert},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,byteLength,(noAssert=Math.pow(2,8*byteLength-1))-1,-noAssert);var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,byteLength,(noAssert=Math.pow(2,8*byteLength-1))-1,-noAssert);var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),this[offset]=255&(value=value<0?255+value+1:value),offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=(value=value<0?4294967295+value+1:value)>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var code;1===val.length&&(code=val.charCodeAt(0),"utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");var i;if(!(end<=start))if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray((str=>{if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str})(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}}.call(this)}.call(this,require("buffer").Buffer)},{"base64-js":2,buffer:3,ieee754:4}],4:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,nBytes=buffer[offset+i];for(i+=d,e=nBytes&(1<<-nBits)-1,nBytes>>=-nBits,nBits+=eLen;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(nBytes?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(nBytes?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,nBytes=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(isLE=Math.pow(2,-e))<1&&(e--,isLE*=2),2<=(value+=1<=e+eBias?rt/isLE:rt*Math.pow(2,1-eBias))*isLE&&(e++,isLE/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(value*isLE-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*nBytes}},{}],5:[function(require,module,exports){var t,e;t=this,e=function(t){var e=[];function a(a){var n,u,r,d,o,s,F;if(void 0!==a)return/ladda-button/i.test(a.className)||(a.className+=" ladda-button"),a.hasAttribute("data-style")||a.setAttribute("data-style","expand-right"),a.querySelector(".ladda-label")||((u=document.createElement("span")).className="ladda-label",n=a,u=u,(r=document.createRange()).selectNodeContents(n),r.surroundContents(u),n.appendChild(u)),(s=a.querySelector(".ladda-spinner"))||((s=document.createElement("span")).className="ladda-spinner"),a.appendChild(s),F={start:function(){return d=d||(e=>{var a,u,n=e.offsetHeight,e=(32<(n=0===n?parseFloat(window.getComputedStyle(e).height):n)&&(n*=.8),e.hasAttribute("data-spinner-size")&&(n=parseInt(e.getAttribute("data-spinner-size"),10)),e.hasAttribute("data-spinner-color")&&(a=e.getAttribute("data-spinner-color")),e.hasAttribute("data-spinner-lines")&&(u=parseInt(e.getAttribute("data-spinner-lines"),10)),.2*n);return new t({color:a||"#fff",lines:u||12,radius:e,length:.6*e,width:e<7?2:3,zIndex:"auto",top:"auto",left:"auto",className:""})})(a),a.disabled=!0,a.setAttribute("data-loading",""),clearTimeout(o),d.spin(s),this.setProgress(0),this},startAfter:function(t){return clearTimeout(o),o=setTimeout(function(){F.start()},t),this},stop:function(){return F.isLoading()&&(a.disabled=!1,a.removeAttribute("data-loading")),clearTimeout(o),d&&(o=setTimeout(function(){d.stop()},1e3)),this},toggle:function(){return this.isLoading()?this.stop():this.start()},setProgress:function(t){t=Math.max(Math.min(t,1),0);var e=a.querySelector(".ladda-progress");0===t&&e&&e.parentNode?e.parentNode.removeChild(e):(e||((e=document.createElement("div")).className="ladda-progress",a.appendChild(e)),e.style.width=(t||0)*a.offsetWidth+"px")},enable:function(){return this.stop()},disable:function(){return this.stop(),a.disabled=!0,this},isLoading:function(){return a.hasAttribute("data-loading")},remove:function(){clearTimeout(o),a.disabled=!1,a.removeAttribute("data-loading"),d&&(d.stop(),d=null),e.splice(e.indexOf(F),1)}},e.push(F),F;console.warn("Ladda button target must be defined.")}function u(t,e){var u,n;"function"==typeof t.addEventListener&&(u=a(t),n=-1,t.addEventListener("click",function(){var a,i,r=!0,d=((t,e)=>{for(;t.parentNode&&t.tagName!==e;)t=t.parentNode;return e===t.tagName?t:void 0})(t,"FORM");if(void 0!==d&&!d.hasAttribute("novalidate"))if("function"==typeof d.checkValidity)r=d.checkValidity();else{a=d,i=[],["input","textarea","select"].forEach(function(t){for(var e=a.getElementsByTagName(t),u=0;u<e.length;u++)e[u].hasAttribute("required")&&i.push(e[u])});for(var o=i,s=0;s<o.length;s++){var F=o[s],l=F.getAttribute("type");if(""===F.value.replace(/^\s+|\s+$/g,"")&&(r=!1),"checkbox"!==l&&"radio"!==l||F.checked||(r=!1),"email"===l&&(r=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-z0-9-]+(\.[a-z0-9-]+)*$/i.test(F.value)),!(r="url"===l?/^([a-z]([a-z]|\d|\+|-|\.)*):(\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?((\[(|(v[\da-f]{1,}\.(([a-z]|\d|-|\.|_|~)|[!\$&'\(\)\*\+,;=]|:)+))\])|((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=])*)(:\d*)?)(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*|(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)){0})(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(F.value):r))break}}r&&(u.startAfter(1),"number"==typeof e.timeout&&(clearTimeout(n),n=setTimeout(u.stop,e.timeout)),"function"==typeof e.callback)&&e.callback.apply(null,[u])},!1))}return{bind:function(t,e){var a;if("string"==typeof t)a=document.querySelectorAll(t);else{if("object"!=typeof t)throw new Error("target must be string or object");a=[t]}e=e||{};for(var n=0;n<a.length;n++)u(a[n],e)},create:a,stopAll:function(){for(var t=0,a=e.length;t<a;t++)e[t].stop()}}},"object"==typeof exports?module.exports=e(require("spin.js")):"function"==typeof define&&define.amd?define(["spin"],e):t.Ladda=e(t.Spinner)},{"spin.js":68}],6:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.MultipartBody=void 0;class MultipartBody{constructor(body){this.body=body}get[Symbol.toStringTag](){return"MultipartBody"}}exports.MultipartBody=MultipartBody},{}],7:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(require("../web-runtime.js"),exports)},{"../web-runtime.js":10}],8:[function(require,module,exports){let shims=require("./registry");require=require("openai/_shims/auto/runtime");shims.kind||shims.setShims(require.getRuntime(),{auto:!0});for(let property of Object.keys(shims))Object.defineProperty(exports,property,{get(){return shims[property]}})},{"./registry":9,"openai/_shims/auto/runtime":7}],9:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.setShims=exports.isFsReadStream=exports.fileFromPath=exports.getDefaultAgent=exports.getMultipartRequestOptions=exports.ReadableStream=exports.File=exports.Blob=exports.FormData=exports.Headers=exports.Response=exports.Request=exports.fetch=exports.kind=exports.auto=void 0,exports.auto=!1,exports.kind=void 0,exports.fetch=void 0,exports.Request=void 0,exports.Response=void 0,exports.Headers=void 0,exports.FormData=void 0,exports.Blob=void 0,exports.File=void 0,exports.ReadableStream=void 0,exports.getMultipartRequestOptions=void 0,exports.getDefaultAgent=void 0,exports.fileFromPath=void 0,exports.isFsReadStream=void 0,exports.setShims=function(shims,options={auto:!1}){if(exports.auto)throw new Error(`you must \`import 'openai/shims/${shims.kind}'\` before importing anything else from openai`);if(exports.kind)throw new Error(`can't \`import 'openai/shims/${shims.kind}'\` after \`import 'openai/shims/${exports.kind}'\``);exports.auto=options.auto,exports.kind=shims.kind,exports.fetch=shims.fetch,exports.Request=shims.Request,exports.Response=shims.Response,exports.Headers=shims.Headers,exports.FormData=shims.FormData,exports.Blob=shims.Blob,exports.File=shims.File,exports.ReadableStream=shims.ReadableStream,exports.getMultipartRequestOptions=shims.getMultipartRequestOptions,exports.getDefaultAgent=shims.getDefaultAgent,exports.fileFromPath=shims.fileFromPath,exports.isFsReadStream=shims.isFsReadStream}},{}],10:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRuntime=void 0;let MultipartBody_1=require("./MultipartBody.js");exports.getRuntime=function({manuallyImported}={}){let recommendation=manuallyImported?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",_fetch,_Request,_Response,_Headers;try{_fetch=fetch,_Request=Request,_Response=Response,_Headers=Headers}catch(error){throw new Error(`this environment is missing the following Web Fetch API type: ${error.message}. `+recommendation)}return{kind:"web",fetch:_fetch,Request:_Request,Response:_Response,Headers:_Headers,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'FormData' is undefined. "+recommendation)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'Blob' is undefined. "+recommendation)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'File' is undefined. "+recommendation)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error("streaming isn't supported in this environment yet as 'ReadableStream' is undefined. "+recommendation)}},getMultipartRequestOptions:async(form,opts)=>({...opts,body:new MultipartBody_1.MultipartBody(form)}),getDefaultAgent:url=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:value=>!1}}},{"./MultipartBody.js":6}],11:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.MalformedJSON=exports.PartialJSON=exports.partialParse=void 0;let Allow={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511};class PartialJSON extends Error{}exports.PartialJSON=PartialJSON;class MalformedJSON extends Error{}exports.MalformedJSON=MalformedJSON;let _parseJSON=(jsonString,allow)=>{let length=jsonString.length,index=0,markPartialJSON=msg=>{throw new PartialJSON(msg+" at position "+index)},throwMalformedError=msg=>{throw new MalformedJSON(msg+" at position "+index)},parseAny=()=>(skipBlank(),index>=length&&markPartialJSON("Unexpected end of input"),'"'===jsonString[index]?parseStr():"{"===jsonString[index]?parseObj():"["===jsonString[index]?parseArr():"null"===jsonString.substring(index,index+4)||Allow.NULL&allow&&length-index<4&&"null".startsWith(jsonString.substring(index))?(index+=4,null):"true"===jsonString.substring(index,index+4)||Allow.BOOL&allow&&length-index<4&&"true".startsWith(jsonString.substring(index))?(index+=4,!0):"false"===jsonString.substring(index,index+5)||Allow.BOOL&allow&&length-index<5&&"false".startsWith(jsonString.substring(index))?(index+=5,!1):"Infinity"===jsonString.substring(index,index+8)||Allow.INFINITY&allow&&length-index<8&&"Infinity".startsWith(jsonString.substring(index))?(index+=8,1/0):"-Infinity"===jsonString.substring(index,index+9)||Allow.MINUS_INFINITY&allow&&1<length-index&&length-index<9&&"-Infinity".startsWith(jsonString.substring(index))?(index+=9,-1/0):"NaN"===jsonString.substring(index,index+3)||Allow.NAN&allow&&length-index<3&&"NaN".startsWith(jsonString.substring(index))?(index+=3,NaN):parseNum()),parseStr=()=>{var start=index;let escape=!1;for(index++;index<length&&('"'!==jsonString[index]||escape&&"\\"===jsonString[index-1]);)escape="\\"===jsonString[index]&&!escape,index++;if('"'==jsonString.charAt(index))try{return JSON.parse(jsonString.substring(start,++index-Number(escape)))}catch(e){throwMalformedError(String(e))}else if(Allow.STR&allow)try{return JSON.parse(jsonString.substring(start,index-Number(escape))+'"')}catch(e){return JSON.parse(jsonString.substring(start,jsonString.lastIndexOf("\\"))+'"')}markPartialJSON("Unterminated string literal")},parseObj=()=>{index++,skipBlank();var obj={};try{for(;"}"!==jsonString[index];){if(skipBlank(),index>=length&&Allow.OBJ&allow)return obj;var key=parseStr();skipBlank(),index++;try{var value=parseAny();Object.defineProperty(obj,key,{value:value,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(Allow.OBJ&allow)return obj;throw e}skipBlank(),","===jsonString[index]&&index++}}catch(e){if(Allow.OBJ&allow)return obj;markPartialJSON("Expected '}' at end of object")}return index++,obj},parseArr=()=>{index++;var arr=[];try{for(;"]"!==jsonString[index];)arr.push(parseAny()),skipBlank(),","===jsonString[index]&&index++}catch(e){if(Allow.ARR&allow)return arr;markPartialJSON("Expected ']' at end of array")}return index++,arr},parseNum=()=>{if(0===index){"-"===jsonString&&Allow.NUM&allow&&markPartialJSON("Not sure what '-' is");try{return JSON.parse(jsonString)}catch(e){if(Allow.NUM&allow)try{return"."===jsonString[jsonString.length-1]?JSON.parse(jsonString.substring(0,jsonString.lastIndexOf("."))):JSON.parse(jsonString.substring(0,jsonString.lastIndexOf("e")))}catch(e){}throwMalformedError(String(e))}}var start=index;for("-"===jsonString[index]&&index++;jsonString[index]&&!",]}".includes(jsonString[index]);)index++;index!=length||Allow.NUM&allow||markPartialJSON("Unterminated number literal");try{return JSON.parse(jsonString.substring(start,index))}catch(e){"-"===jsonString.substring(start,index)&&Allow.NUM&allow&&markPartialJSON("Not sure what '-' is");try{return JSON.parse(jsonString.substring(start,jsonString.lastIndexOf("e")))}catch(e){throwMalformedError(String(e))}}},skipBlank=()=>{for(;index<length&&" \n\r\t".includes(jsonString[index]);)index++};return parseAny()};exports.partialParse=input=>{var allowPartial=Allow.ALL^Allow.NUM;if("string"!=typeof input)throw new TypeError("expecting str, got "+typeof input);if(input.trim())return _parseJSON(input.trim(),allowPartial);throw new Error(input+" is empty")}},{}],12:[function(require,module,exports){!function(process,Buffer){!function(){var _AbstractPage_client,__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value;throw new TypeError("Cannot write private member to an object whose class did not declare it")},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver);throw new TypeError("Cannot read private member from an object whose class did not declare it")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.isObj=exports.toBase64=exports.getHeader=exports.getRequiredHeader=exports.isHeadersProtocol=exports.isRunningInBrowser=exports.debug=exports.hasOwn=exports.isEmptyObj=exports.maybeCoerceBoolean=exports.maybeCoerceFloat=exports.maybeCoerceInteger=exports.coerceBoolean=exports.coerceFloat=exports.coerceInteger=exports.readEnv=exports.ensurePresent=exports.castToError=exports.sleep=exports.safeJSON=exports.isRequestOptions=exports.createResponseHeaders=exports.PagePromise=exports.AbstractPage=exports.APIClient=exports.APIPromise=exports.createForm=exports.multipartFormRequestOptions=exports.maybeMultipartFormRequestOptions=void 0;let version_1=require("./version.js"),streaming_1=require("./streaming.js"),error_1=require("./error.js"),index_1=require("./_shims/index.js"),uploads_1=require("./uploads.js");var uploads_2=require("./uploads.js");async function defaultParseResponse(props){var response=props.response;return props.options.stream?(debug("response",response.status,response.url,response.headers,response.body),(props.options.__streamClass||streaming_1.Stream).fromSSEResponse(response,props.controller)):204===response.status?null:props.options.__binaryResponse?response:(props=response.headers.get("content-type"))?.includes("application/json")||props?.includes("application/vnd.api+json")?(props=await response.json(),debug("response",response.status,response.url,response.headers,props),_addRequestID(props,response)):(props=await response.text(),debug("response",response.status,response.url,response.headers,props),props)}function _addRequestID(value,response){return!value||"object"!=typeof value||Array.isArray(value)?value:Object.defineProperty(value,"_request_id",{value:response.headers.get("x-request-id"),enumerable:!1})}Object.defineProperty(exports,"maybeMultipartFormRequestOptions",{enumerable:!0,get:function(){return uploads_2.maybeMultipartFormRequestOptions}}),Object.defineProperty(exports,"multipartFormRequestOptions",{enumerable:!0,get:function(){return uploads_2.multipartFormRequestOptions}}),Object.defineProperty(exports,"createForm",{enumerable:!0,get:function(){return uploads_2.createForm}});class APIPromise extends Promise{constructor(responsePromise,parseResponse=defaultParseResponse){super(resolve=>{resolve(null)}),this.responsePromise=responsePromise,this.parseResponse=parseResponse}_thenUnwrap(transform){return new APIPromise(this.responsePromise,async props=>_addRequestID(transform(await this.parseResponse(props),props),props.response))}asResponse(){return this.responsePromise.then(p=>p.response)}async withResponse(){var[data,response]=await Promise.all([this.parse(),this.asResponse()]);return{data:data,response:response,request_id:response.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(onfulfilled,onrejected){return this.parse().then(onfulfilled,onrejected)}catch(onrejected){return this.parse().catch(onrejected)}finally(onfinally){return this.parse().finally(onfinally)}}exports.APIPromise=APIPromise;exports.APIClient=class{constructor({baseURL,maxRetries=2,timeout=6e5,httpAgent,fetch:overridenFetch}){this.baseURL=baseURL,this.maxRetries=validatePositiveInteger("maxRetries",maxRetries),this.timeout=validatePositiveInteger("timeout",timeout),this.httpAgent=httpAgent,this.fetch=overridenFetch??index_1.fetch}authHeaders(opts){return{}}defaultHeaders(opts){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...getPlatformHeaders(),...this.authHeaders(opts)}}validateHeaders(headers,customHeaders){}defaultIdempotencyKey(){return"stainless-node-retry-"+uuid4()}get(path,opts){return this.methodRequest("get",path,opts)}post(path,opts){return this.methodRequest("post",path,opts)}patch(path,opts){return this.methodRequest("patch",path,opts)}put(path,opts){return this.methodRequest("put",path,opts)}delete(path,opts){return this.methodRequest("delete",path,opts)}methodRequest(method,path,opts){return this.request(Promise.resolve(opts).then(async opts=>{var body=opts&&(0,uploads_1.isBlobLike)(opts?.body)?new DataView(await opts.body.arrayBuffer()):opts?.body instanceof DataView?opts.body:opts?.body instanceof ArrayBuffer?new DataView(opts.body):opts&&ArrayBuffer.isView(opts?.body)?new DataView(opts.body.buffer):opts?.body;return{method:method,path:path,...opts,body:body}}))}getAPIList(path,Page,opts){return this.requestAPIList(Page,{method:"get",path:path,...opts})}calculateContentLength(body){if("string"==typeof body){if(void 0!==Buffer)return Buffer.byteLength(body,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(body).length.toString()}else if(ArrayBuffer.isView(body))return body.byteLength.toString();return null}buildRequest(options,{retryCount=0}={}){var{method,path,query,headers={}}=options,body=ArrayBuffer.isView(options.body)||options.__binaryRequest&&"string"==typeof options.body?options.body:(0,uploads_1.isMultipartBody)(options.body)?options.body.body:options.body?JSON.stringify(options.body,null,2):null,contentLength=this.calculateContentLength(body),path=this.buildURL(path,query),query=("timeout"in options&&validatePositiveInteger("timeout",options.timeout),options.timeout??this.timeout),httpAgent=options.httpAgent??this.httpAgent??(0,index_1.getDefaultAgent)(path),minAgentTimeout=query+1e3,minAgentTimeout=("number"==typeof httpAgent?.options?.timeout&&minAgentTimeout>(httpAgent.options.timeout??0)&&(httpAgent.options.timeout=minAgentTimeout),this.idempotencyHeader&&"get"!==method&&(options.idempotencyKey||(options.idempotencyKey=this.defaultIdempotencyKey()),headers[this.idempotencyHeader]=options.idempotencyKey),this.buildHeaders({options:options,headers:headers,contentLength:contentLength,retryCount:retryCount}));return{req:{method:method,...body&&{body:body},headers:minAgentTimeout,...httpAgent&&{agent:httpAgent},signal:options.signal??null},url:path,timeout:query}}buildHeaders({options,headers,contentLength,retryCount}){var reqHeaders={},contentLength=(contentLength&&(reqHeaders["content-length"]=contentLength),this.defaultHeaders(options));return applyHeadersMut(reqHeaders,contentLength),applyHeadersMut(reqHeaders,headers),(0,uploads_1.isMultipartBody)(options.body)&&"node"!==index_1.kind&&delete reqHeaders["content-type"],void 0===(0,exports.getHeader)(contentLength,"x-stainless-retry-count")&&void 0===(0,exports.getHeader)(headers,"x-stainless-retry-count")&&(reqHeaders["x-stainless-retry-count"]=String(retryCount)),this.validateHeaders(reqHeaders,headers),reqHeaders}async prepareOptions(options){}async prepareRequest(request,{}){}parseHeaders(headers){return headers?Symbol.iterator in headers?Object.fromEntries(Array.from(headers).map(header=>[...header])):{...headers}:{}}makeStatusError(status,error,message,headers){return error_1.APIError.generate(status,error,message,headers)}request(options,remainingRetries=null){return new APIPromise(this.makeRequest(options,remainingRetries))}async makeRequest(optionsInput,retriesRemaining){var optionsInput=await optionsInput,maxRetries=optionsInput.maxRetries??this.maxRetries,{req:maxRetries,url,timeout}=(null==retriesRemaining&&(retriesRemaining=maxRetries),await this.prepareOptions(optionsInput),this.buildRequest(optionsInput,{retryCount:maxRetries-retriesRemaining}));if(await this.prepareRequest(maxRetries,{url:url,options:optionsInput}),debug("request",url,optionsInput,maxRetries.headers),optionsInput.signal?.aborted)throw new error_1.APIUserAbortError;var controller=new AbortController,maxRetries=await this.fetchWithTimeout(url,maxRetries,timeout,controller).catch(exports.castToError);if(maxRetries instanceof Error){if(optionsInput.signal?.aborted)throw new error_1.APIUserAbortError;if(retriesRemaining)return this.retryRequest(optionsInput,retriesRemaining);if("AbortError"===maxRetries.name)throw new error_1.APIConnectionTimeoutError;throw new error_1.APIConnectionError({cause:maxRetries})}timeout=(0,exports.createResponseHeaders)(maxRetries.headers);if(maxRetries.ok)return{response:maxRetries,options:optionsInput,controller:controller};if(retriesRemaining&&this.shouldRetry(maxRetries)){let retryMessage=`retrying, ${retriesRemaining} attempts remaining`;return debug(`response (error; ${retryMessage})`,maxRetries.status,url,timeout),this.retryRequest(optionsInput,retriesRemaining,timeout)}controller=await maxRetries.text().catch(e=>(0,exports.castToError)(e).message),optionsInput=(0,exports.safeJSON)(controller),controller=optionsInput?void 0:controller,debug(`response (error; ${retriesRemaining?"(error; no more retries left)":"(error; not retryable)"})`,maxRetries.status,url,timeout,controller),retriesRemaining=this.makeStatusError(maxRetries.status,optionsInput,controller,timeout);throw retriesRemaining}requestAPIList(Page,options){options=this.makeRequest(options,null);return new PagePromise(this,options,Page)}buildURL(path,query){var path=isAbsoluteURL(path)?new URL(path):new URL(this.baseURL+(this.baseURL.endsWith("/")&&path.startsWith("/")?path.slice(1):path)),defaultQuery=this.defaultQuery();return"object"==typeof(query=isEmptyObj(defaultQuery)?query:{...defaultQuery,...query})&&query&&!Array.isArray(query)&&(path.search=this.stringifyQuery(query)),path.toString()}stringifyQuery(query){return Object.entries(query).filter(([,value])=>void 0!==value).map(([key,value])=>{if("string"==typeof value||"number"==typeof value||"boolean"==typeof value)return encodeURIComponent(key)+"="+encodeURIComponent(value);if(null===value)return encodeURIComponent(key)+"=";throw new error_1.OpenAIError(`Cannot stringify type ${typeof value}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(url,init,ms,controller){let{signal,...options}=init||{},timeout=(signal&&signal.addEventListener("abort",()=>controller.abort()),setTimeout(()=>controller.abort(),ms));return this.getRequestClient().fetch.call(void 0,url,{signal:controller.signal,...options}).finally(()=>{clearTimeout(timeout)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(response){var shouldRetryHeader=response.headers.get("x-should-retry");return"true"===shouldRetryHeader||"false"!==shouldRetryHeader&&(408===response.status||409===response.status||429===response.status||500<=response.status)}async retryRequest(options,retriesRemaining,responseHeaders){let timeoutMillis;var retryAfterMillisHeader=responseHeaders?.["retry-after-ms"],retryAfterMillisHeader=(retryAfterMillisHeader&&(retryAfterMillisHeader=parseFloat(retryAfterMillisHeader),Number.isNaN(retryAfterMillisHeader)||(timeoutMillis=retryAfterMillisHeader)),responseHeaders?.["retry-after"]);return retryAfterMillisHeader&&!timeoutMillis&&(responseHeaders=parseFloat(retryAfterMillisHeader),timeoutMillis=Number.isNaN(responseHeaders)?Date.parse(retryAfterMillisHeader)-Date.now():1e3*responseHeaders),timeoutMillis&&0<=timeoutMillis&&timeoutMillis<6e4||(retryAfterMillisHeader=options.maxRetries??this.maxRetries,timeoutMillis=this.calculateDefaultRetryTimeoutMillis(retriesRemaining,retryAfterMillisHeader)),await(0,exports.sleep)(timeoutMillis),this.makeRequest(options,retriesRemaining-1)}calculateDefaultRetryTimeoutMillis(retriesRemaining,maxRetries){return Math.min(.5*Math.pow(2,maxRetries-retriesRemaining),8)*(1-.25*Math.random())*1e3}getUserAgent(){return this.constructor.name+"/JS "+version_1.VERSION}};class AbstractPage{constructor(client,response,body,options){_AbstractPage_client.set(this,void 0),__classPrivateFieldSet(this,_AbstractPage_client,client,"f"),this.options=options,this.response=response,this.body=body}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){var nextInfo=this.nextPageInfo();if(!nextInfo)throw new error_1.OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");var key,value,nextOptions={...this.options};if("params"in nextInfo&&"object"==typeof nextOptions.query)nextOptions.query={...nextOptions.query,...nextInfo.params};else if("url"in nextInfo){for([key,value]of[...Object.entries(nextOptions.query||{}),...nextInfo.url.searchParams.entries()])nextInfo.url.searchParams.set(key,value);nextOptions.query=void 0,nextOptions.path=nextInfo.url.toString()}return __classPrivateFieldGet(this,_AbstractPage_client,"f").requestAPIList(this.constructor,nextOptions)}async*iterPages(){let page=this;for(yield page;page.hasNextPage();)yield page=await page.getNextPage()}async*[(_AbstractPage_client=new WeakMap,Symbol.asyncIterator)](){for await(var page of this.iterPages())for(var item of page.getPaginatedItems())yield item}}exports.AbstractPage=AbstractPage;class PagePromise extends APIPromise{constructor(client,request,Page){super(request,async props=>new Page(client,props.response,await defaultParseResponse(props),props.options))}async*[Symbol.asyncIterator](){var item;for await(item of await this)yield item}}exports.PagePromise=PagePromise;exports.createResponseHeaders=headers=>new Proxy(Object.fromEntries(headers.entries()),{get(target,name){name=name.toString();return target[name.toLowerCase()]||target[name]}});let requestOptionsKeys={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0};exports.isRequestOptions=obj=>"object"==typeof obj&&null!==obj&&!isEmptyObj(obj)&&Object.keys(obj).every(k=>hasOwn(requestOptionsKeys,k));let getPlatformProperties=()=>{var browserInfo;return"undefined"!=typeof Deno&&null!=Deno.build?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,"X-Stainless-OS":normalizePlatform(Deno.build.os),"X-Stainless-Arch":normalizeArch(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"}:"undefined"!=typeof EdgeRuntime?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:"+EdgeRuntime,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version}:"[object process]"===Object.prototype.toString.call(void 0!==process?process:0)?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,"X-Stainless-OS":normalizePlatform(process.platform),"X-Stainless-Arch":normalizeArch(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version}:(browserInfo=(()=>{var key,pattern;if("undefined"!=typeof navigator&&navigator)for({key,pattern}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){var major,minor,match=pattern.exec(navigator.userAgent);if(match)return major=match[1]||0,minor=match[2]||0,match=match[3]||0,{browser:key,version:major+`.${minor}.`+match}}return null})())?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"browser:"+browserInfo.browser,"X-Stainless-Runtime-Version":browserInfo.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};let normalizeArch=arch=>"x32"===arch?"x32":"x86_64"===arch||"x64"===arch?"x64":"arm"===arch?"arm":"aarch64"===arch||"arm64"===arch?"arm64":arch?"other:"+arch:"unknown",normalizePlatform=platform=>(platform=platform.toLowerCase()).includes("ios")?"iOS":"android"===platform?"Android":"darwin"===platform?"MacOS":"win32"===platform?"Windows":"freebsd"===platform?"FreeBSD":"openbsd"===platform?"OpenBSD":"linux"===platform?"Linux":platform?"Other:"+platform:"Unknown",_platformHeaders,getPlatformHeaders=()=>_platformHeaders=_platformHeaders??getPlatformProperties();exports.safeJSON=text=>{try{return JSON.parse(text)}catch(err){}};let startsWithSchemeRegexp=new RegExp("^(?:[a-z]+:)?//","i"),isAbsoluteURL=url=>startsWithSchemeRegexp.test(url);exports.sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms));let validatePositiveInteger=(name,n)=>{if("number"!=typeof n||!Number.isInteger(n))throw new error_1.OpenAIError(name+" must be an integer");if(n<0)throw new error_1.OpenAIError(name+" must be a positive integer");return n};exports.castToError=err=>{if(err instanceof Error)return err;if("object"==typeof err&&null!==err)try{return new Error(JSON.stringify(err))}catch{}return new Error(err)},exports.ensurePresent=value=>{if(null==value)throw new error_1.OpenAIError(`Expected a value to be given but received ${value} instead.`);return value},exports.readEnv=env=>void 0!==process?process.env?.[env]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(env)?.trim():void 0,exports.coerceInteger=value=>{if("number"==typeof value)return Math.round(value);if("string"==typeof value)return parseInt(value,10);throw new error_1.OpenAIError(`Could not coerce ${value} (type: ${typeof value}) into a number`)},exports.coerceFloat=value=>{if("number"==typeof value)return value;if("string"==typeof value)return parseFloat(value);throw new error_1.OpenAIError(`Could not coerce ${value} (type: ${typeof value}) into a number`)},exports.coerceBoolean=value=>"boolean"==typeof value?value:"string"==typeof value?"true"===value:Boolean(value),exports.maybeCoerceInteger=value=>{if(void 0!==value)return(0,exports.coerceInteger)(value)},exports.maybeCoerceFloat=value=>{if(void 0!==value)return(0,exports.coerceFloat)(value)};function isEmptyObj(obj){if(obj)for(var _k in obj)return!1;return!0}function hasOwn(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function applyHeadersMut(targetHeaders,newHeaders){for(var k in newHeaders){var lowerKey;hasOwn(newHeaders,k)&&(lowerKey=k.toLowerCase())&&(null===(k=newHeaders[k])?delete targetHeaders[lowerKey]:void 0!==k&&(targetHeaders[lowerKey]=k))}}function debug(action,...args){void 0!==process&&"true"===process?.env?.DEBUG&&console.log("OpenAI:DEBUG:"+action,...args)}exports.maybeCoerceBoolean=value=>{if(void 0!==value)return(0,exports.coerceBoolean)(value)},exports.isEmptyObj=isEmptyObj,exports.hasOwn=hasOwn,exports.debug=debug;let uuid4=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)});exports.isRunningInBrowser=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,exports.isHeadersProtocol=headers=>"function"==typeof headers?.get,exports.getRequiredHeader=(headers,header)=>{headers=(0,exports.getHeader)(headers,header);if(void 0===headers)throw new Error(`Could not find ${header} header`);return headers},exports.getHeader=(headers,header)=>{var lowerCasedHeader=header.toLowerCase();if((0,exports.isHeadersProtocol)(headers)){var key,intercapsHeader=header[0]?.toUpperCase()+header.substring(1).replace(/([^\w])(\w)/g,(_m,g1,g2)=>g1+g2.toUpperCase());for(key of[header,lowerCasedHeader,header.toUpperCase(),intercapsHeader]){var value=headers.get(key);if(value)return value}}for(let[key,value]of Object.entries(headers))if(key.toLowerCase()===lowerCasedHeader)return Array.isArray(value)?(value.length<=1||console.warn(`Received ${value.length} entries for the ${header} header, using the first entry.`),value[0]):value};exports.toBase64=str=>{if(!str)return"";if(void 0!==Buffer)return Buffer.from(str).toString("base64");if("undefined"!=typeof btoa)return btoa(str);throw new error_1.OpenAIError("Cannot generate b64 string; Expected `Buffer` or `btoa` to be defined")},exports.isObj=function(obj){return null!=obj&&"object"==typeof obj&&!Array.isArray(obj)}}.call(this)}.call(this,require("_process"),require("buffer").Buffer)},{"./_shims/index.js":8,"./error.js":13,"./streaming.js":64,"./uploads.js":65,"./version.js":66,_process:67,buffer:3}],13:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ContentFilterFinishReasonError=exports.LengthFinishReasonError=exports.InternalServerError=exports.RateLimitError=exports.UnprocessableEntityError=exports.ConflictError=exports.NotFoundError=exports.PermissionDeniedError=exports.AuthenticationError=exports.BadRequestError=exports.APIConnectionTimeoutError=exports.APIConnectionError=exports.APIUserAbortError=exports.APIError=exports.OpenAIError=void 0;let core_1=require("./core.js");class OpenAIError extends Error{}exports.OpenAIError=OpenAIError;class APIError extends OpenAIError{constructor(status,error,message,headers){super(""+APIError.makeMessage(status,error,message)),this.status=status,this.headers=headers,this.request_id=headers?.["x-request-id"];message=error;this.error=message,this.code=message?.code,this.param=message?.param,this.type=message?.type}static makeMessage(status,error,message){error=error?.message?"string"==typeof error.message?error.message:JSON.stringify(error.message):error?JSON.stringify(error):message;return status&&error?status+" "+error:status?status+" status code (no body)":error||"(no status code or body)"}static generate(status,errorResponse,message,headers){var error;return status?(error=errorResponse?.error,new(400===status?BadRequestError:401===status?AuthenticationError:403===status?PermissionDeniedError:404===status?NotFoundError:409===status?ConflictError:422===status?UnprocessableEntityError:429===status?RateLimitError:500<=status?InternalServerError:APIError)(status,error,message,headers)):new APIConnectionError({message:message,cause:(0,core_1.castToError)(errorResponse)})}}exports.APIError=APIError;class APIUserAbortError extends APIError{constructor({message}={}){super(void 0,void 0,message||"Request was aborted.",void 0),this.status=void 0}}exports.APIUserAbortError=APIUserAbortError;class APIConnectionError extends APIError{constructor({message,cause}){super(void 0,void 0,message||"Connection error.",void 0),this.status=void 0,cause&&(this.cause=cause)}}exports.APIConnectionError=APIConnectionError;class APIConnectionTimeoutError extends APIConnectionError{constructor({message}={}){super({message:message??"Request timed out."})}}exports.APIConnectionTimeoutError=APIConnectionTimeoutError;class BadRequestError extends APIError{constructor(){super(...arguments),this.status=400}}exports.BadRequestError=BadRequestError;class AuthenticationError extends APIError{constructor(){super(...arguments),this.status=401}}exports.AuthenticationError=AuthenticationError;class PermissionDeniedError extends APIError{constructor(){super(...arguments),this.status=403}}exports.PermissionDeniedError=PermissionDeniedError;class NotFoundError extends APIError{constructor(){super(...arguments),this.status=404}}exports.NotFoundError=NotFoundError;class ConflictError extends APIError{constructor(){super(...arguments),this.status=409}}exports.ConflictError=ConflictError;class UnprocessableEntityError extends APIError{constructor(){super(...arguments),this.status=422}}exports.UnprocessableEntityError=UnprocessableEntityError;class RateLimitError extends APIError{constructor(){super(...arguments),this.status=429}}exports.RateLimitError=RateLimitError;class InternalServerError extends APIError{}exports.InternalServerError=InternalServerError;class LengthFinishReasonError extends OpenAIError{constructor(){super("Could not parse response content as the length limit was reached")}}exports.LengthFinishReasonError=LengthFinishReasonError;class ContentFilterFinishReasonError extends OpenAIError{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}exports.ContentFilterFinishReasonError=ContentFilterFinishReasonError},{"./core.js":12}],14:[function(require,module,exports){!function(process){!function(){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UnprocessableEntityError=exports.PermissionDeniedError=exports.InternalServerError=exports.AuthenticationError=exports.BadRequestError=exports.RateLimitError=exports.ConflictError=exports.NotFoundError=exports.APIUserAbortError=exports.APIConnectionTimeoutError=exports.APIConnectionError=exports.APIError=exports.OpenAIError=exports.fileFromPath=exports.toFile=exports.AzureOpenAI=exports.OpenAI=void 0;let qs=__importStar(require("./internal/qs/index.js")),Core=__importStar(require("./core.js")),Errors=__importStar(require("./error.js"));__importStar(require("./pagination.js"));var Uploads=__importStar(require("./uploads.js"));let API=__importStar(require("./resources/index.js"));var __importStar=require("./resources/batches.js"),completions_1=require("./resources/completions.js"),embeddings_1=require("./resources/embeddings.js"),files_1=require("./resources/files.js"),images_1=require("./resources/images.js"),models_1=require("./resources/models.js"),moderations_1=require("./resources/moderations.js"),audio_1=require("./resources/audio/audio.js"),beta_1=require("./resources/beta/beta.js"),chat_1=require("./resources/chat/chat.js"),fine_tuning_1=require("./resources/fine-tuning/fine-tuning.js"),uploads_1=require("./resources/uploads/uploads.js");class OpenAI extends Core.APIClient{constructor({baseURL=Core.readEnv("OPENAI_BASE_URL"),apiKey=Core.readEnv("OPENAI_API_KEY"),organization=Core.readEnv("OPENAI_ORG_ID")??null,project=Core.readEnv("OPENAI_PROJECT_ID")??null,...opts}={}){if(void 0===apiKey)throw new Errors.OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");opts={apiKey:apiKey,organization:organization,project:project,...opts,baseURL:baseURL||"https://api.openai.com/v1"};if(!opts.dangerouslyAllowBrowser&&Core.isRunningInBrowser())throw new Errors.OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:opts.baseURL,timeout:opts.timeout??6e5,httpAgent:opts.httpAgent,maxRetries:opts.maxRetries,fetch:opts.fetch}),this.completions=new API.Completions(this),this.chat=new API.Chat(this),this.embeddings=new API.Embeddings(this),this.files=new API.Files(this),this.images=new API.Images(this),this.audio=new API.Audio(this),this.moderations=new API.Moderations(this),this.models=new API.Models(this),this.fineTuning=new API.FineTuning(this),this.beta=new API.Beta(this),this.batches=new API.Batches(this),this.uploads=new API.Uploads(this),this._options=opts,this.apiKey=apiKey,this.organization=organization,this.project=project}defaultQuery(){return this._options.defaultQuery}defaultHeaders(opts){return{...super.defaultHeaders(opts),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(opts){return{Authorization:"Bearer "+this.apiKey}}stringifyQuery(query){return qs.stringify(query,{arrayFormat:"brackets"})}}((exports.OpenAI=OpenAI).OpenAI=OpenAI).DEFAULT_TIMEOUT=6e5,OpenAI.OpenAIError=Errors.OpenAIError,OpenAI.APIError=Errors.APIError,OpenAI.APIConnectionError=Errors.APIConnectionError,OpenAI.APIConnectionTimeoutError=Errors.APIConnectionTimeoutError,OpenAI.APIUserAbortError=Errors.APIUserAbortError,OpenAI.NotFoundError=Errors.NotFoundError,OpenAI.ConflictError=Errors.ConflictError,OpenAI.RateLimitError=Errors.RateLimitError,OpenAI.BadRequestError=Errors.BadRequestError,OpenAI.AuthenticationError=Errors.AuthenticationError,OpenAI.InternalServerError=Errors.InternalServerError,OpenAI.PermissionDeniedError=Errors.PermissionDeniedError,OpenAI.UnprocessableEntityError=Errors.UnprocessableEntityError,OpenAI.toFile=Uploads.toFile,OpenAI.fileFromPath=Uploads.fileFromPath,OpenAI.Completions=completions_1.Completions,OpenAI.Chat=chat_1.Chat,OpenAI.Embeddings=embeddings_1.Embeddings,OpenAI.Files=files_1.Files,OpenAI.FileObjectsPage=files_1.FileObjectsPage,OpenAI.Images=images_1.Images,OpenAI.Audio=audio_1.Audio,OpenAI.Moderations=moderations_1.Moderations,OpenAI.Models=models_1.Models,OpenAI.ModelsPage=models_1.ModelsPage,OpenAI.FineTuning=fine_tuning_1.FineTuning,OpenAI.Beta=beta_1.Beta,OpenAI.Batches=__importStar.Batches,OpenAI.BatchesPage=__importStar.BatchesPage,OpenAI.Uploads=uploads_1.Uploads;class AzureOpenAI extends OpenAI{constructor({baseURL=Core.readEnv("OPENAI_BASE_URL"),apiKey=Core.readEnv("AZURE_OPENAI_API_KEY"),apiVersion=Core.readEnv("OPENAI_API_VERSION"),endpoint,deployment,azureADTokenProvider,dangerouslyAllowBrowser,...opts}={}){if(!apiVersion)throw new Errors.OpenAIError("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if("function"==typeof azureADTokenProvider&&(dangerouslyAllowBrowser=!0),!azureADTokenProvider&&!apiKey)throw new Errors.OpenAIError("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(azureADTokenProvider&&apiKey)throw new Errors.OpenAIError("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(apiKey=apiKey??API_KEY_SENTINEL,opts.defaultQuery={...opts.defaultQuery,"api-version":apiVersion},baseURL){if(endpoint)throw new Errors.OpenAIError("baseURL and endpoint are mutually exclusive")}else{if(!(endpoint=endpoint||process.env.AZURE_OPENAI_ENDPOINT))throw new Errors.OpenAIError("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");baseURL=endpoint+"/openai"}super({apiKey:apiKey,baseURL:baseURL,...opts,...void 0!==dangerouslyAllowBrowser?{dangerouslyAllowBrowser:dangerouslyAllowBrowser}:{}}),this.apiVersion="",this._azureADTokenProvider=azureADTokenProvider,this.apiVersion=apiVersion,this._deployment=deployment}buildRequest(options){if(_deployments_endpoints.has(options.path)&&"post"===options.method&&void 0!==options.body){if(!Core.isObj(options.body))throw new Error("Expected request body to be an object");var model=this._deployment||options.body.model;void 0===model||this.baseURL.includes("/deployments")||(options.path="/deployments/"+model+options.path)}return super.buildRequest(options)}async _getAzureADToken(){if("function"==typeof this._azureADTokenProvider){var token=await this._azureADTokenProvider();if(token&&"string"==typeof token)return token;throw new Errors.OpenAIError("Expected 'azureADTokenProvider' argument to return a string but it returned "+token)}}authHeaders(opts){return{}}async prepareOptions(opts){if(!opts.headers?.["api-key"]){var token=await this._getAzureADToken();if(opts.headers??(opts.headers={}),token)opts.headers.Authorization="Bearer "+token;else{if(this.apiKey===API_KEY_SENTINEL)throw new Errors.OpenAIError("Unable to handle auth");opts.headers["api-key"]=this.apiKey}}return super.prepareOptions(opts)}}exports.AzureOpenAI=AzureOpenAI;let _deployments_endpoints=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]),API_KEY_SENTINEL="<Missing Key>";var uploads_2=require("./uploads.js"),error_1=(Object.defineProperty(exports,"toFile",{enumerable:!0,get:function(){return uploads_2.toFile}}),Object.defineProperty(exports,"fileFromPath",{enumerable:!0,get:function(){return uploads_2.fileFromPath}}),require("./error.js"));Object.defineProperty(exports,"OpenAIError",{enumerable:!0,get:function(){return error_1.OpenAIError}}),Object.defineProperty(exports,"APIError",{enumerable:!0,get:function(){return error_1.APIError}}),Object.defineProperty(exports,"APIConnectionError",{enumerable:!0,get:function(){return error_1.APIConnectionError}}),Object.defineProperty(exports,"APIConnectionTimeoutError",{enumerable:!0,get:function(){return error_1.APIConnectionTimeoutError}}),Object.defineProperty(exports,"APIUserAbortError",{enumerable:!0,get:function(){return error_1.APIUserAbortError}}),Object.defineProperty(exports,"NotFoundError",{enumerable:!0,get:function(){return error_1.NotFoundError}}),Object.defineProperty(exports,"ConflictError",{enumerable:!0,get:function(){return error_1.ConflictError}}),Object.defineProperty(exports,"RateLimitError",{enumerable:!0,get:function(){return error_1.RateLimitError}}),Object.defineProperty(exports,"BadRequestError",{enumerable:!0,get:function(){return error_1.BadRequestError}}),Object.defineProperty(exports,"AuthenticationError",{enumerable:!0,get:function(){return error_1.AuthenticationError}}),Object.defineProperty(exports,"InternalServerError",{enumerable:!0,get:function(){return error_1.InternalServerError}}),Object.defineProperty(exports,"PermissionDeniedError",{enumerable:!0,get:function(){return error_1.PermissionDeniedError}}),Object.defineProperty(exports,"UnprocessableEntityError",{enumerable:!0,get:function(){return error_1.UnprocessableEntityError}}),exports=module.exports=OpenAI,module.exports.AzureOpenAI=AzureOpenAI,exports.default=OpenAI}.call(this)}.call(this,require("_process"))},{"./core.js":12,"./error.js":13,"./internal/qs/index.js":17,"./pagination.js":30,"./resources/audio/audio.js":32,"./resources/batches.js":36,"./resources/beta/beta.js":38,"./resources/chat/chat.js":48,"./resources/completions.js":51,"./resources/embeddings.js":52,"./resources/files.js":53,"./resources/fine-tuning/fine-tuning.js":54,"./resources/images.js":57,"./resources/index.js":58,"./resources/models.js":59,"./resources/moderations.js":60,"./resources/uploads/uploads.js":63,"./uploads.js":65,_process:67}],15:[function(require,module,exports){!function(Buffer){!function(){Object.defineProperty(exports,"__esModule",{value:!0}),exports.LineDecoder=void 0;let error_1=require("../../error.js");class LineDecoder{constructor(){this.buffer=[],this.trailingCR=!1}decode(chunk){let text=this.decodeText(chunk);if(this.trailingCR&&(text="\r"+text,this.trailingCR=!1),text.endsWith("\r")&&(this.trailingCR=!0,text=text.slice(0,-1)),!text)return[];chunk=LineDecoder.NEWLINE_CHARS.has(text[text.length-1]||"");let lines=text.split(LineDecoder.NEWLINE_REGEXP);return chunk&&lines.pop(),1!==lines.length||chunk?(0<this.buffer.length&&(lines=[this.buffer.join("")+lines[0],...lines.slice(1)],this.buffer=[]),chunk||(this.buffer=[lines.pop()||""]),lines):(this.buffer.push(lines[0]),[])}decodeText(bytes){if(null==bytes)return"";if("string"==typeof bytes)return bytes;if(void 0!==Buffer){if(bytes instanceof Buffer)return bytes.toString();if(bytes instanceof Uint8Array)return Buffer.from(bytes).toString();throw new error_1.OpenAIError(`Unexpected: received non-Uint8Array (${bytes.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"==typeof TextDecoder)throw new error_1.OpenAIError("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.");if(bytes instanceof Uint8Array||bytes instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(bytes);throw new error_1.OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${bytes.constructor.name}) in a web platform. Please report this error.`)}flush(){var lines;return this.buffer.length||this.trailingCR?(lines=[this.buffer.join("")],this.buffer=[],this.trailingCR=!1,lines):[]}}(exports.LineDecoder=LineDecoder).NEWLINE_CHARS=new Set(["\n","\r"]),LineDecoder.NEWLINE_REGEXP=/\r\n|[\n\r]/g}.call(this)}.call(this,require("buffer").Buffer)},{"../../error.js":13,buffer:3}],16:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.RFC3986=exports.RFC1738=exports.formatters=exports.default_format=void 0,exports.default_format="RFC3986",exports.formatters={RFC1738:v=>String(v).replace(/%20/g,"+"),RFC3986:v=>String(v)},exports.RFC1738="RFC1738",exports.RFC3986="RFC3986"},{}],17:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.formats=exports.stringify=void 0;var formats_1=require("./formats.js"),formats_1={formatters:formats_1.formatters,RFC1738:formats_1.RFC1738,RFC3986:formats_1.RFC3986,default:formats_1.default_format},stringify_1=(exports.formats=formats_1,require("./stringify.js"));Object.defineProperty(exports,"stringify",{enumerable:!0,get:function(){return stringify_1.stringify}})},{"./formats.js":16,"./stringify.js":18}],18:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.stringify=void 0;let utils_1=require("./utils.js"),formats_1=require("./formats.js"),has=Object.prototype.hasOwnProperty,array_prefix_generators={brackets(prefix){return String(prefix)+"[]"},comma:"comma",indices(prefix,key){return String(prefix)+"["+key+"]"},repeat(prefix){return String(prefix)}},is_array=Array.isArray,push=Array.prototype.push,push_to_array=function(arr,value_or_array){push.apply(arr,is_array(value_or_array)?value_or_array:[value_or_array])},to_ISO=Date.prototype.toISOString,defaults={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:utils_1.encode,encodeValuesOnly:!1,format:formats_1.default_format,formatter:formats_1.formatters[formats_1.default_format],indices:!1,serializeDate(date){return to_ISO.call(date)},skipNulls:!1,strictNullHandling:!1};let sentinel={};exports.stringify=function(object,opts={}){let obj=object;var options=((opts=defaults)=>{if(void 0!==opts.allowEmptyArrays&&"boolean"!=typeof opts.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==opts.encodeDotInKeys&&"boolean"!=typeof opts.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!=opts.encoder&&"function"!=typeof opts.encoder)throw new TypeError("Encoder has to be a function.");var charset=opts.charset||defaults.charset;if(void 0!==opts.charset&&"utf-8"!==opts.charset&&"iso-8859-1"!==opts.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let format=formats_1.default_format;if(void 0!==opts.format){if(!has.call(formats_1.formatters,opts.format))throw new TypeError("Unknown format option provided.");format=opts.format}var formatter=formats_1.formatters[format];let filter=defaults.filter;"function"!=typeof opts.filter&&!is_array(opts.filter)||(filter=opts.filter);let arrayFormat;if(arrayFormat=opts.arrayFormat&&opts.arrayFormat in array_prefix_generators?opts.arrayFormat:"indices"in opts?opts.indices?"indices":"repeat":defaults.arrayFormat,"commaRoundTrip"in opts&&"boolean"!=typeof opts.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var allowDots=void 0===opts.allowDots?!0==!!opts.encodeDotInKeys||defaults.allowDots:!!opts.allowDots;return{addQueryPrefix:("boolean"==typeof opts.addQueryPrefix?opts:defaults).addQueryPrefix,allowDots:allowDots,allowEmptyArrays:"boolean"==typeof opts.allowEmptyArrays?!!opts.allowEmptyArrays:defaults.allowEmptyArrays,arrayFormat:arrayFormat,charset:charset,charsetSentinel:("boolean"==typeof opts.charsetSentinel?opts:defaults).charsetSentinel,commaRoundTrip:!!opts.commaRoundTrip,delimiter:(void 0===opts.delimiter?defaults:opts).delimiter,encode:("boolean"==typeof opts.encode?opts:defaults).encode,encodeDotInKeys:("boolean"==typeof opts.encodeDotInKeys?opts:defaults).encodeDotInKeys,encoder:("function"==typeof opts.encoder?opts:defaults).encoder,encodeValuesOnly:("boolean"==typeof opts.encodeValuesOnly?opts:defaults).encodeValuesOnly,filter:filter,format:format,formatter:formatter,serializeDate:("function"==typeof opts.serializeDate?opts:defaults).serializeDate,skipNulls:("boolean"==typeof opts.skipNulls?opts:defaults).skipNulls,sort:"function"==typeof opts.sort?opts.sort:null,strictNullHandling:("boolean"==typeof opts.strictNullHandling?opts:defaults).strictNullHandling}})(opts);let obj_keys,filter;"function"==typeof options.filter?(filter=options.filter,obj=filter("",obj)):is_array(options.filter)&&(filter=options.filter,obj_keys=filter);var keys=[];if("object"!=typeof obj||null===obj)return"";var generateArrayPrefix=array_prefix_generators[options.arrayFormat],commaRoundTrip="comma"===generateArrayPrefix&&options.commaRoundTrip,sideChannel=(obj_keys=obj_keys||Object.keys(obj),options.sort&&obj_keys.sort(options.sort),new WeakMap);for(let i=0;i<obj_keys.length;++i){var key=obj_keys[i];options.skipNulls&&null===obj[key]||push_to_array(keys,function inner_stringify(object,prefix,generateArrayPrefix,commaRoundTrip,allowEmptyArrays,strictNullHandling,skipNulls,encodeDotInKeys,encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,sideChannel){let obj=object,tmp_sc=sideChannel,step=0,find_flag=!1;for(;void 0!==(tmp_sc=tmp_sc.get(sentinel))&&!find_flag;){var pos=tmp_sc.get(object);if(step+=1,void 0!==pos){if(pos===step)throw new RangeError("Cyclic object value");find_flag=!0}void 0===tmp_sc.get(sentinel)&&(step=0)}if("function"==typeof filter?obj=filter(prefix,obj):obj instanceof Date?obj=serializeDate?.(obj):"comma"===generateArrayPrefix&&is_array(obj)&&(obj=(0,utils_1.maybe_map)(obj,function(value){return value instanceof Date?serializeDate?.(value):value})),null===obj){if(strictNullHandling)return encoder&&!encodeValuesOnly?encoder(prefix,defaults.encoder,charset,"key",format):prefix;obj=""}if("string"==typeof(v=obj)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||(0,utils_1.is_buffer)(obj))return encoder?(v=encodeValuesOnly?prefix:encoder(prefix,defaults.encoder,charset,"key",format),[formatter?.(v)+"="+formatter?.(encoder(obj,defaults.encoder,charset,"value",format))]):[formatter?.(prefix)+"="+formatter?.(String(obj))];var values=[];if(void 0!==obj){let obj_keys;obj_keys="comma"===generateArrayPrefix&&is_array(obj)?[{value:0<(obj=encodeValuesOnly&&encoder?(0,utils_1.maybe_map)(obj,encoder):obj).length?obj.join(",")||null:void 0}]:is_array(filter)?filter:(v=Object.keys(obj),sort?v.sort(sort):v);var v=encodeDotInKeys?String(prefix).replace(/\./g,"%2E"):String(prefix),adjusted_prefix=commaRoundTrip&&is_array(obj)&&1===obj.length?v+"[]":v;if(allowEmptyArrays&&is_array(obj)&&0===obj.length)return adjusted_prefix+"[]";for(let j=0;j<obj_keys.length;++j){var valueSideChannel,key=obj_keys[j],value="object"==typeof key&&void 0!==key.value?key.value:obj[key];skipNulls&&null===value||(key=allowDots&&encodeDotInKeys?key.replace(/\./g,"%2E"):key,key=is_array(obj)?"function"==typeof generateArrayPrefix?generateArrayPrefix(adjusted_prefix,key):adjusted_prefix:adjusted_prefix+(allowDots?"."+key:"["+key+"]"),sideChannel.set(object,step),(valueSideChannel=new WeakMap).set(sentinel,sideChannel),push_to_array(values,inner_stringify(value,key,generateArrayPrefix,commaRoundTrip,allowEmptyArrays,strictNullHandling,skipNulls,encodeDotInKeys,"comma"===generateArrayPrefix&&encodeValuesOnly&&is_array(obj)?null:encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,valueSideChannel)))}}return values}(obj[key],key,generateArrayPrefix,commaRoundTrip,options.allowEmptyArrays,options.strictNullHandling,options.skipNulls,options.encodeDotInKeys,options.encode?options.encoder:null,options.filter,options.sort,options.allowDots,options.serializeDate,options.format,options.formatter,options.encodeValuesOnly,options.charset,sideChannel))}object=keys.join(options.delimiter);let prefix=!0===options.addQueryPrefix?"?":"";return options.charsetSentinel&&("iso-8859-1"===options.charset?prefix+="utf8=%26%2310003%3B&":prefix+="utf8=%E2%9C%93&"),0<object.length?prefix+object:""}},{"./formats.js":16,"./utils.js":19}],19:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.maybe_map=exports.combine=exports.is_buffer=exports.is_regexp=exports.compact=exports.encode=exports.decode=exports.assign_single_source=exports.merge=void 0;let formats_1=require("./formats.js"),has=Object.prototype.hasOwnProperty,is_array=Array.isArray,hex_table=(()=>{var array=[];for(let i=0;i<256;++i)array.push("%"+((i<16?"0":"")+i.toString(16)).toUpperCase());return array})();exports.merge=function merge(target,source,options={}){if(!source)return target;if("object"!=typeof source){if(is_array(target))target.push(source);else{if(!target||"object"!=typeof target)return[target,source];(options&&(options.plainObjects||options.allowPrototypes)||!has.call(Object.prototype,source))&&(target[source]=!0)}return target}if(!target||"object"!=typeof target)return[target].concat(source);let mergeTarget=target;return is_array(target)&&!is_array(source)&&(mergeTarget=((source,options)=>{var obj=options&&options.plainObjects?Object.create(null):{};for(let i=0;i<source.length;++i)void 0!==source[i]&&(obj[i]=source[i]);return obj})(target,options)),is_array(target)&&is_array(source)?(source.forEach(function(item,i){var targetItem;has.call(target,i)?(targetItem=target[i])&&"object"==typeof targetItem&&item&&"object"==typeof item?target[i]=merge(targetItem,item,options):target.push(item):target[i]=item}),target):Object.keys(source).reduce(function(acc,key){var value=source[key];return has.call(acc,key)?acc[key]=merge(acc[key],value,options):acc[key]=value,acc},mergeTarget)},exports.assign_single_source=function(target,source){return Object.keys(source).reduce(function(acc,key){return acc[key]=source[key],acc},target)},exports.decode=function(str,_,charset){if(str=str.replace(/\+/g," "),"iso-8859-1"===charset)return str.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(str)}catch(e){return str}};exports.encode=(str,_defaultEncoder,charset,_kind,format)=>{if(0===str.length)return str;let string=str;if("symbol"==typeof str?string=Symbol.prototype.toString.call(str):"string"!=typeof str&&(string=String(str)),"iso-8859-1"===charset)return escape(string).replace(/%u[0-9a-f]{4}/gi,function($0){return"%26%23"+parseInt($0.slice(2),16)+"%3B"});let out="";for(let j=0;j<string.length;j+=1024){var segment=1024<=string.length?string.slice(j,j+1024):string,arr=[];for(let i=0;i<segment.length;++i){var c=segment.charCodeAt(i);45===c||46===c||95===c||126===c||48<=c&&c<=57||65<=c&&c<=90||97<=c&&c<=122||format===formats_1.RFC1738&&(40===c||41===c)?arr[arr.length]=segment.charAt(i):c<128?arr[arr.length]=hex_table[c]:c<2048?arr[arr.length]=hex_table[192|c>>6]+hex_table[128|63&c]:c<55296||57344<=c?arr[arr.length]=hex_table[224|c>>12]+hex_table[128|c>>6&63]+hex_table[128|63&c]:(i+=1,c=65536+((1023&c)<<10|1023&segment.charCodeAt(i)),arr[arr.length]=hex_table[240|c>>18]+hex_table[128|c>>12&63]+hex_table[128|c>>6&63]+hex_table[128|63&c])}out+=arr.join("")}return out},exports.compact=function(value){var queue=[{obj:{o:value},prop:"o"}],refs=[];for(let i=0;i<queue.length;++i){var item=queue[i],obj=item.obj[item.prop],keys=Object.keys(obj);for(let j=0;j<keys.length;++j){var key=keys[j],val=obj[key];"object"==typeof val&&null!==val&&-1===refs.indexOf(val)&&(queue.push({obj:obj,prop:key}),refs.push(val))}}return(queue=>{for(;1<queue.length;){var item=queue.pop();if(item){var obj=item.obj[item.prop];if(is_array(obj)){var compacted=[];for(let j=0;j<obj.length;++j)void 0!==obj[j]&&compacted.push(obj[j]);item.obj[item.prop]=compacted}}}})(queue),value},exports.is_regexp=function(obj){return"[object RegExp]"===Object.prototype.toString.call(obj)},exports.is_buffer=function(obj){return!(!obj||"object"!=typeof obj||!(obj.constructor&&obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)))},exports.combine=function(a,b){return[].concat(a,b)},exports.maybe_map=function(val,fn){if(is_array(val)){var mapped=[];for(let i=0;i<val.length;i+=1)mapped.push(fn(val[i]));return mapped}return fn(val)}},{"./formats.js":16}],20:[function(require,module,exports){var _AbstractChatCompletionRunner_instances,_AbstractChatCompletionRunner_getFinalContent,_AbstractChatCompletionRunner_getFinalMessage,_AbstractChatCompletionRunner_getFinalFunctionCall,_AbstractChatCompletionRunner_getFinalFunctionCallResult,_AbstractChatCompletionRunner_calculateTotalUsage,_AbstractChatCompletionRunner_validateParams,_AbstractChatCompletionRunner_stringifyFunctionCallResult,__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver);throw new TypeError("Cannot read private member from an object whose class did not declare it")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractChatCompletionRunner=void 0;let error_1=require("../error.js"),RunnableFunction_1=require("./RunnableFunction.js"),chatCompletionUtils_1=require("./chatCompletionUtils.js");var EventStream_1=require("./EventStream.js");let parser_1=require("../lib/parser.js");class AbstractChatCompletionRunner extends EventStream_1.EventStream{constructor(){super(...arguments),_AbstractChatCompletionRunner_instances.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(chatCompletion){this._chatCompletions.push(chatCompletion),this._emit("chatCompletion",chatCompletion);var message=chatCompletion.choices[0]?.message;return message&&this._addMessage(message),chatCompletion}_addMessage(message,emit=!0){if("content"in message||(message.content=null),this.messages.push(message),emit)if(this._emit("message",message),((0,chatCompletionUtils_1.isFunctionMessage)(message)||(0,chatCompletionUtils_1.isToolMessage)(message))&&message.content)this._emit("functionCallResult",message.content);else if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&message.function_call)this._emit("functionCall",message.function_call);else if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&message.tool_calls)for(var tool_call of message.tool_calls)"function"===tool_call.type&&this._emit("functionCall",tool_call.function)}async finalChatCompletion(){await this.done();var completion=this._chatCompletions[this._chatCompletions.length-1];if(completion)return completion;throw new error_1.OpenAIError("stream ended without producing a ChatCompletion")}async finalContent(){return await this.done(),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalContent).call(this)}async finalMessage(){return await this.done(),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this)}async finalFunctionCall(){return await this.done(),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCall).call(this)}async finalFunctionCallResult(){return await this.done(),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this)}async totalUsage(){return await this.done(),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_calculateTotalUsage).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){var completion=this._chatCompletions[this._chatCompletions.length-1],completion=(completion&&this._emit("finalChatCompletion",completion),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this)),completion=(completion&&this._emit("finalMessage",completion),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalContent).call(this)),completion=(completion&&this._emit("finalContent",completion),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCall).call(this)),completion=(completion&&this._emit("finalFunctionCall",completion),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this));null!=completion&&this._emit("finalFunctionCallResult",completion),this._chatCompletions.some(c=>c.usage)&&this._emit("totalUsage",__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_calculateTotalUsage).call(this))}async _createChatCompletion(client,params,options){var signal=options?.signal,signal=(signal&&(signal.aborted&&this.controller.abort(),signal.addEventListener("abort",()=>this.controller.abort())),__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_validateParams).call(this,params),await client.chat.completions.create({...params,stream:!1},{...options,signal:this.controller.signal}));return this._connected(),this._addChatCompletion((0,parser_1.parseChatCompletion)(signal,params))}async _runChatCompletion(client,params,options){for(var message of params.messages)this._addMessage(message,!1);return this._createChatCompletion(client,params,options)}async _runFunctions(client,params,options){var role="function";let{function_call="auto",stream,...restParams}=params;var f,singleFunctionToCall="string"!=typeof function_call&&function_call?.name,{maxChatCompletions=10}=options||{},functionsByName={};for(f of params.functions)functionsByName[f.name||f.function.name]=f;var message,functions=params.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(message of params.messages)this._addMessage(message,!1);for(let i=0;i<maxChatCompletions;++i){let message=(await this._createChatCompletion(client,{...restParams,function_call:function_call,functions:functions,messages:[...this.messages]},options)).choices[0]?.message;if(!message)throw new error_1.OpenAIError("missing message in ChatCompletion response");if(!message.function_call)return;var{name,arguments:args}=message.function_call,fn=functionsByName[name];if(fn)if(singleFunctionToCall&&singleFunctionToCall!==name){let content=`Invalid function_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;this._addMessage({role:role,name:name,content:content})}else{let parsed;try{parsed=(0,RunnableFunction_1.isRunnableFunctionWithParse)(fn)?await fn.parse(args):args}catch(error){this._addMessage({role:role,name:name,content:error instanceof Error?error.message:String(error)});continue}args=await fn.function(parsed,this),fn=__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_stringifyFunctionCallResult).call(this,args);if(this._addMessage({role:role,name:name,content:fn}),singleFunctionToCall)return}else{let content=`Invalid function_call: ${JSON.stringify(name)}. Available options are: ${functions.map(f=>JSON.stringify(f.name)).join(", ")}. Please try again`;this._addMessage({role:role,name:name,content:content})}}}async _runTools(client,params,options){let{tool_choice="auto",stream,...restParams}=params;var f,singleFunctionToCall="string"!=typeof tool_choice&&tool_choice?.function?.name,{maxChatCompletions=10}=options||{},inputTools=params.tools.map(tool=>{if((0,parser_1.isAutoParsableTool)(tool)){if(tool.$callback)return{type:"function",function:{function:tool.$callback,name:tool.function.name,description:tool.function.description||"",parameters:tool.function.parameters,parse:tool.$parseRaw,strict:!0}};throw new error_1.OpenAIError("Tool given to `.runTools()` that does not have an associated function")}return tool}),functionsByName={};for(f of inputTools)"function"===f.type&&(functionsByName[f.function.name||f.function.function.name]=f.function);var message,tool_call,tools="tools"in params?inputTools.map(t=>"function"===t.type?{type:"function",function:{name:t.function.name||t.function.function.name,parameters:t.function.parameters,description:t.function.description,strict:t.function.strict}}:t):void 0;for(message of params.messages)this._addMessage(message,!1);for(let i=0;i<maxChatCompletions;++i){let message=(await this._createChatCompletion(client,{...restParams,tool_choice:tool_choice,tools:tools,messages:[...this.messages]},options)).choices[0]?.message;if(!message)throw new error_1.OpenAIError("missing message in ChatCompletion response");if(!message.tool_calls?.length)return;for(tool_call of message.tool_calls)if("function"===tool_call.type){var tool_call_id=tool_call.id,{name,arguments:args}=tool_call.function,fn=functionsByName[name];if(fn)if(singleFunctionToCall&&singleFunctionToCall!==name){let content=`Invalid tool_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;this._addMessage({role:"tool",tool_call_id:tool_call_id,content:content})}else{let parsed;try{parsed=(0,RunnableFunction_1.isRunnableFunctionWithParse)(fn)?await fn.parse(args):args}catch(error){let content=error instanceof Error?error.message:String(error);this._addMessage({role:"tool",tool_call_id:tool_call_id,content:content});continue}args=await fn.function(parsed,this),fn=__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_stringifyFunctionCallResult).call(this,args);if(this._addMessage({role:"tool",tool_call_id:tool_call_id,content:fn}),singleFunctionToCall)return}else{let content=`Invalid tool_call: ${JSON.stringify(name)}. Available options are: ${Object.keys(functionsByName).map(name=>JSON.stringify(name)).join(", ")}. Please try again`;this._addMessage({role:"tool",tool_call_id:tool_call_id,content:content})}}}}}exports.AbstractChatCompletionRunner=AbstractChatCompletionRunner,_AbstractChatCompletionRunner_instances=new WeakSet,_AbstractChatCompletionRunner_getFinalContent=function(){return __classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this).content??null},_AbstractChatCompletionRunner_getFinalMessage=function(){let i=this.messages.length;for(;0<i--;){var message=this.messages[i];if((0,chatCompletionUtils_1.isAssistantMessage)(message)){let{function_call,...rest}=message;message={...rest,content:message.content??null,refusal:message.refusal??null};return function_call&&(message.function_call=function_call),message}}throw new error_1.OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},_AbstractChatCompletionRunner_getFinalFunctionCall=function(){for(let i=this.messages.length-1;0<=i;i--){var message=this.messages[i];if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&message?.function_call)return message.function_call;if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&message?.tool_calls?.length)return message.tool_calls.at(-1)?.function}},_AbstractChatCompletionRunner_getFinalFunctionCallResult=function(){for(let i=this.messages.length-1;0<=i;i--){let message=this.messages[i];if((0,chatCompletionUtils_1.isFunctionMessage)(message)&&null!=message.content)return message.content;if((0,chatCompletionUtils_1.isToolMessage)(message)&&null!=message.content&&"string"==typeof message.content&&this.messages.some(x=>"assistant"===x.role&&x.tool_calls?.some(y=>"function"===y.type&&y.id===message.tool_call_id)))return message.content}},_AbstractChatCompletionRunner_calculateTotalUsage=function(){var usage,total={completion_tokens:0,prompt_tokens:0,total_tokens:0};for({usage}of this._chatCompletions)usage&&(total.completion_tokens+=usage.completion_tokens,total.prompt_tokens+=usage.prompt_tokens,total.total_tokens+=usage.total_tokens);return total},_AbstractChatCompletionRunner_validateParams=function(params){if(null!=params.n&&1<params.n)throw new error_1.OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},_AbstractChatCompletionRunner_stringifyFunctionCallResult=function(rawContent){return"string"==typeof rawContent?rawContent:void 0===rawContent?"undefined":JSON.stringify(rawContent)}},{"../error.js":13,"../lib/parser.js":29,"./EventStream.js":25,"./RunnableFunction.js":26,"./chatCompletionUtils.js":28}],21:[function(require,module,exports){var _AssistantStream_instances,_AssistantStream_events,_AssistantStream_runStepSnapshots,_AssistantStream_messageSnapshots,_AssistantStream_messageSnapshot,_AssistantStream_finalRun,_AssistantStream_currentContentIndex,_AssistantStream_currentContent,_AssistantStream_currentToolCallIndex,_AssistantStream_currentToolCall,_AssistantStream_currentEvent,_AssistantStream_currentRunSnapshot,_AssistantStream_currentRunStepSnapshot,_AssistantStream_addEvent,_AssistantStream_endRequest,_AssistantStream_handleMessage,_AssistantStream_handleRunStep,_AssistantStream_handleEvent,_AssistantStream_accumulateRunStep,_AssistantStream_accumulateMessage,_AssistantStream_accumulateContent,_AssistantStream_handleRun,__createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver);throw new TypeError("Cannot read private member from an object whose class did not declare it")},__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value;throw new TypeError("Cannot write private member to an object whose class did not declare it")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AssistantStream=void 0;let Core=__importStar(require("../core.js")),streaming_1=require("../streaming.js"),error_1=require("../error.js");__importStar=require("./EventStream.js");class AssistantStream extends __importStar.EventStream{constructor(){super(...arguments),_AssistantStream_instances.add(this),_AssistantStream_events.set(this,[]),_AssistantStream_runStepSnapshots.set(this,{}),_AssistantStream_messageSnapshots.set(this,{}),_AssistantStream_messageSnapshot.set(this,void 0),_AssistantStream_finalRun.set(this,void 0),_AssistantStream_currentContentIndex.set(this,void 0),_AssistantStream_currentContent.set(this,void 0),_AssistantStream_currentToolCallIndex.set(this,void 0),_AssistantStream_currentToolCall.set(this,void 0),_AssistantStream_currentEvent.set(this,void 0),_AssistantStream_currentRunSnapshot.set(this,void 0),_AssistantStream_currentRunStepSnapshot.set(this,void 0)}[(_AssistantStream_events=new WeakMap,_AssistantStream_runStepSnapshots=new WeakMap,_AssistantStream_messageSnapshots=new WeakMap,_AssistantStream_messageSnapshot=new WeakMap,_AssistantStream_finalRun=new WeakMap,_AssistantStream_currentContentIndex=new WeakMap,_AssistantStream_currentContent=new WeakMap,_AssistantStream_currentToolCallIndex=new WeakMap,_AssistantStream_currentToolCall=new WeakMap,_AssistantStream_currentEvent=new WeakMap,_AssistantStream_currentRunSnapshot=new WeakMap,_AssistantStream_currentRunStepSnapshot=new WeakMap,_AssistantStream_instances=new WeakSet,Symbol.asyncIterator)](){let pushQueue=[],readQueue=[],done=!1;return this.on("event",event=>{var reader=readQueue.shift();reader?reader.resolve(event):pushQueue.push(event)}),this.on("end",()=>{done=!0;for(var reader of readQueue)reader.resolve(void 0);readQueue.length=0}),this.on("abort",err=>{done=!0;for(var reader of readQueue)reader.reject(err);readQueue.length=0}),this.on("error",err=>{done=!0;for(var reader of readQueue)reader.reject(err);readQueue.length=0}),{next:async()=>pushQueue.length?{value:pushQueue.shift(),done:!1}:done?{value:void 0,done:!0}:new Promise((resolve,reject)=>readQueue.push({resolve:resolve,reject:reject})).then(chunk=>chunk?{value:chunk,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(stream){let runner=new AssistantStream;return runner._run(()=>runner._fromReadableStream(stream)),runner}async _fromReadableStream(readableStream,options){var event,options=options?.signal,options=(options&&(options.aborted&&this.controller.abort(),options.addEventListener("abort",()=>this.controller.abort())),this._connected(),streaming_1.Stream.fromReadableStream(readableStream,this.controller));for await(event of options)__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event);if(options.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addRun(__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}toReadableStream(){return new streaming_1.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(threadId,runId,runs,params,options){let runner=new AssistantStream;return runner._run(()=>runner._runToolAssistantStream(threadId,runId,runs,params,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}})),runner}async _createToolAssistantStream(run,threadId,runId,params,options){var event,signal=options?.signal,signal=(signal&&(signal.aborted&&this.controller.abort(),signal.addEventListener("abort",()=>this.controller.abort())),{...params,stream:!0}),params=await run.submitToolOutputs(threadId,runId,signal,{...options,signal:this.controller.signal});this._connected();for await(event of params)__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event);if(params.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addRun(__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}static createThreadAssistantStream(params,thread,options){let runner=new AssistantStream;return runner._run(()=>runner._threadAssistantStream(params,thread,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}})),runner}static createAssistantStream(threadId,runs,params,options){let runner=new AssistantStream;return runner._run(()=>runner._runAssistantStream(threadId,runs,params,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}})),runner}currentEvent(){return __classPrivateFieldGet(this,_AssistantStream_currentEvent,"f")}currentRun(){return __classPrivateFieldGet(this,_AssistantStream_currentRunSnapshot,"f")}currentMessageSnapshot(){return __classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f")}currentRunStepSnapshot(){return __classPrivateFieldGet(this,_AssistantStream_currentRunStepSnapshot,"f")}async finalRunSteps(){return await this.done(),Object.values(__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f"))}async finalMessages(){return await this.done(),Object.values(__classPrivateFieldGet(this,_AssistantStream_messageSnapshots,"f"))}async finalRun(){if(await this.done(),__classPrivateFieldGet(this,_AssistantStream_finalRun,"f"))return __classPrivateFieldGet(this,_AssistantStream_finalRun,"f");throw Error("Final run was not received.")}async _createThreadAssistantStream(thread,params,options){var event,signal=options?.signal,signal=(signal&&(signal.aborted&&this.controller.abort(),signal.addEventListener("abort",()=>this.controller.abort())),{...params,stream:!0}),params=await thread.createAndRun(signal,{...options,signal:this.controller.signal});this._connected();for await(event of params)__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event);if(params.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addRun(__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}async _createAssistantStream(run,threadId,params,options){var event,signal=options?.signal,signal=(signal&&(signal.aborted&&this.controller.abort(),signal.addEventListener("abort",()=>this.controller.abort())),{...params,stream:!0}),params=await run.create(threadId,signal,{...options,signal:this.controller.signal});this._connected();for await(event of params)__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event);if(params.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addRun(__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}static accumulateDelta(acc,delta){for(var[key,deltaValue]of Object.entries(delta))if(acc.hasOwnProperty(key)){let accValue=acc[key];if(null==accValue)acc[key]=deltaValue;else if("index"===key||"type"===key)acc[key]=deltaValue;else{if("string"==typeof accValue&&"string"==typeof deltaValue)accValue+=deltaValue;else if("number"==typeof accValue&&"number"==typeof deltaValue)accValue+=deltaValue;else{if(!Core.isObj(accValue)||!Core.isObj(deltaValue)){if(Array.isArray(accValue)&&Array.isArray(deltaValue)){if(accValue.every(x=>"string"==typeof x||"number"==typeof x)){accValue.push(...deltaValue);continue}for(var deltaEntry of deltaValue){if(!Core.isObj(deltaEntry))throw new Error("Expected array delta entry to be an object but got: "+deltaEntry);var index=deltaEntry.index;if(null==index)throw console.error(deltaEntry),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof index)throw new Error("Expected array delta entry `index` property to be a number but got "+index);var accEntry=accValue[index];null==accEntry?accValue.push(deltaEntry):accValue[index]=this.accumulateDelta(accEntry,deltaEntry)}continue}throw Error(`Unhandled record type: ${key}, deltaValue: ${deltaValue}, accValue: `+accValue)}accValue=this.accumulateDelta(accValue,deltaValue)}acc[key]=accValue}}else acc[key]=deltaValue;return acc}_addRun(run){return run}async _threadAssistantStream(params,thread,options){return this._createThreadAssistantStream(thread,params,options)}async _runAssistantStream(threadId,runs,params,options){return this._createAssistantStream(runs,threadId,params,options)}async _runToolAssistantStream(threadId,runId,runs,params,options){return this._createToolAssistantStream(runs,threadId,runId,params,options)}}exports.AssistantStream=AssistantStream,_AssistantStream_addEvent=function(event){if(!this.ended)switch(__classPrivateFieldSet(this,_AssistantStream_currentEvent,event,"f"),__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleEvent).call(this,event),event.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleRun).call(this,event);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleRunStep).call(this,event);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleMessage).call(this,event);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},_AssistantStream_endRequest=function(){if(this.ended)throw new error_1.OpenAIError("stream has ended, this shouldn't happen");if(__classPrivateFieldGet(this,_AssistantStream_finalRun,"f"))return __classPrivateFieldGet(this,_AssistantStream_finalRun,"f");throw Error("Final run has not been received")},_AssistantStream_handleMessage=function(event){var content,[accumulatedMessage,newContent]=__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateMessage).call(this,event,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));__classPrivateFieldSet(this,_AssistantStream_messageSnapshot,accumulatedMessage,"f"),__classPrivateFieldGet(this,_AssistantStream_messageSnapshots,"f")[accumulatedMessage.id]=accumulatedMessage;for(content of newContent){var snapshotContent=accumulatedMessage.content[content.index];"text"==snapshotContent?.type&&this._emit("textCreated",snapshotContent.text)}switch(event.event){case"thread.message.created":this._emit("messageCreated",event.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",event.data.delta,accumulatedMessage),event.data.delta.content)for(let content of event.data.delta.content){if("text"==content.type&&content.text){var textDelta=content.text,snapshot=accumulatedMessage.content[content.index];if(!snapshot||"text"!=snapshot.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",textDelta,snapshot.text)}if(content.index!=__classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")){if(__classPrivateFieldGet(this,_AssistantStream_currentContent,"f"))switch(__classPrivateFieldGet(this,_AssistantStream_currentContent,"f").type){case"text":this._emit("textDone",__classPrivateFieldGet(this,_AssistantStream_currentContent,"f").text,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));break;case"image_file":this._emit("imageFileDone",__classPrivateFieldGet(this,_AssistantStream_currentContent,"f").image_file,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"))}__classPrivateFieldSet(this,_AssistantStream_currentContentIndex,content.index,"f")}__classPrivateFieldSet(this,_AssistantStream_currentContent,accumulatedMessage.content[content.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==__classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")){var currentContent=event.data.content[__classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")];if(currentContent)switch(currentContent.type){case"image_file":this._emit("imageFileDone",currentContent.image_file,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));break;case"text":this._emit("textDone",currentContent.text,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"))}}__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f")&&this._emit("messageDone",event.data),__classPrivateFieldSet(this,_AssistantStream_messageSnapshot,void 0,"f")}},_AssistantStream_handleRunStep=function(event){var accumulatedRunStep=__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateRunStep).call(this,event);switch(__classPrivateFieldSet(this,_AssistantStream_currentRunStepSnapshot,accumulatedRunStep,"f"),event.event){case"thread.run.step.created":this._emit("runStepCreated",event.data);break;case"thread.run.step.delta":var delta=event.data.delta;if(delta.step_details&&"tool_calls"==delta.step_details.type&&delta.step_details.tool_calls&&"tool_calls"==accumulatedRunStep.step_details.type)for(var toolCall of delta.step_details.tool_calls)toolCall.index==__classPrivateFieldGet(this,_AssistantStream_currentToolCallIndex,"f")?this._emit("toolCallDelta",toolCall,accumulatedRunStep.step_details.tool_calls[toolCall.index]):(__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")&&this._emit("toolCallDone",__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")),__classPrivateFieldSet(this,_AssistantStream_currentToolCallIndex,toolCall.index,"f"),__classPrivateFieldSet(this,_AssistantStream_currentToolCall,accumulatedRunStep.step_details.tool_calls[toolCall.index],"f"),__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")&&this._emit("toolCallCreated",__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")));this._emit("runStepDelta",event.data.delta,accumulatedRunStep);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":__classPrivateFieldSet(this,_AssistantStream_currentRunStepSnapshot,void 0,"f"),"tool_calls"==event.data.step_details.type&&__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")&&(this._emit("toolCallDone",__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")),__classPrivateFieldSet(this,_AssistantStream_currentToolCall,void 0,"f")),this._emit("runStepDone",event.data,accumulatedRunStep)}},_AssistantStream_handleEvent=function(event){__classPrivateFieldGet(this,_AssistantStream_events,"f").push(event),this._emit("event",event)},_AssistantStream_accumulateRunStep=function(event){switch(event.event){case"thread.run.step.created":return __classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id]=event.data,event.data;case"thread.run.step.delta":var data,snapshot=__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id];if(snapshot)return(data=event.data).delta&&(snapshot=AssistantStream.accumulateDelta(snapshot,data.delta),__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id]=snapshot),__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id];throw Error("Received a RunStepDelta before creation of a snapshot");case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id]=event.data}if(__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id])return __classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id];throw new Error("No snapshot available")},_AssistantStream_accumulateMessage=function(event,snapshot){var newContent=[];switch(event.event){case"thread.message.created":return[event.data,newContent];case"thread.message.delta":if(!snapshot)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");var currentContent,data=event.data;if(data.delta.content)for(var contentElement of data.delta.content)contentElement.index in snapshot.content?(currentContent=snapshot.content[contentElement.index],snapshot.content[contentElement.index]=__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateContent).call(this,contentElement,currentContent)):(snapshot.content[contentElement.index]=contentElement,newContent.push(contentElement));return[snapshot,newContent];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(snapshot)return[snapshot,newContent];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},_AssistantStream_accumulateContent=function(contentElement,currentContent){return AssistantStream.accumulateDelta(currentContent,contentElement)},_AssistantStream_handleRun=function(event){switch(__classPrivateFieldSet(this,_AssistantStream_currentRunSnapshot,event.data,"f"),event.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":__classPrivateFieldSet(this,_AssistantStream_finalRun,event.data,"f"),__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")&&(this._emit("toolCallDone",__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")),__classPrivateFieldSet(this,_AssistantStream_currentToolCall,void 0,"f"))}}},{"../core.js":12,"../error.js":13,"../streaming.js":64,"./EventStream.js":25}],22:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ChatCompletionRunner=void 0;var AbstractChatCompletionRunner_1=require("./AbstractChatCompletionRunner.js");let chatCompletionUtils_1=require("./chatCompletionUtils.js");class ChatCompletionRunner extends AbstractChatCompletionRunner_1.AbstractChatCompletionRunner{static runFunctions(client,params,options){let runner=new ChatCompletionRunner,opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return runner._run(()=>runner._runFunctions(client,params,opts)),runner}static runTools(client,params,options){let runner=new ChatCompletionRunner,opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runTools"}};return runner._run(()=>runner._runTools(client,params,opts)),runner}_addMessage(message,emit=!0){super._addMessage(message,emit),(0,chatCompletionUtils_1.isAssistantMessage)(message)&&message.content&&this._emit("content",message.content)}}exports.ChatCompletionRunner=ChatCompletionRunner},{"./AbstractChatCompletionRunner.js":20,"./chatCompletionUtils.js":28}],23:[function(require,module,exports){var _ChatCompletionStream_instances,_ChatCompletionStream_params,_ChatCompletionStream_choiceEventStates,_ChatCompletionStream_currentChatCompletionSnapshot,_ChatCompletionStream_beginRequest,_ChatCompletionStream_getChoiceEventState,_ChatCompletionStream_addChunk,_ChatCompletionStream_emitToolCallDoneEvent,_ChatCompletionStream_emitContentDoneEvents,_ChatCompletionStream_endRequest,_ChatCompletionStream_getAutoParseableResponseFormat,_ChatCompletionStream_accumulateChatCompletion,__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value;throw new TypeError("Cannot write private member to an object whose class did not declare it")},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver);throw new TypeError("Cannot read private member from an object whose class did not declare it")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ChatCompletionStream=void 0;let error_1=require("../error.js");var AbstractChatCompletionRunner_1=require("./AbstractChatCompletionRunner.js");let streaming_1=require("../streaming.js"),parser_1=require("../lib/parser.js"),parser_2=require("../_vendor/partial-json-parser/parser.js");class ChatCompletionStream extends AbstractChatCompletionRunner_1.AbstractChatCompletionRunner{constructor(params){super(),_ChatCompletionStream_instances.add(this),_ChatCompletionStream_params.set(this,void 0),_ChatCompletionStream_choiceEventStates.set(this,void 0),_ChatCompletionStream_currentChatCompletionSnapshot.set(this,void 0),__classPrivateFieldSet(this,_ChatCompletionStream_params,params,"f"),__classPrivateFieldSet(this,_ChatCompletionStream_choiceEventStates,[],"f")}get currentChatCompletionSnapshot(){return __classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f")}static fromReadableStream(stream){let runner=new ChatCompletionStream(null);return runner._run(()=>runner._fromReadableStream(stream)),runner}static createChatCompletion(client,params,options){let runner=new ChatCompletionStream(params);return runner._run(()=>runner._runChatCompletion(client,{...params,stream:!0},{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}})),runner}async _createChatCompletion(client,params,options){super._createChatCompletion;var chunk,signal=options?.signal,signal=(signal&&(signal.aborted&&this.controller.abort(),signal.addEventListener("abort",()=>this.controller.abort())),__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_beginRequest).call(this),await client.chat.completions.create({...params,stream:!0},{...options,signal:this.controller.signal}));this._connected();for await(chunk of signal)__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_addChunk).call(this,chunk);if(signal.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addChatCompletion(__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(this))}async _fromReadableStream(readableStream,options){var chunk,options=options?.signal,options=(options&&(options.aborted&&this.controller.abort(),options.addEventListener("abort",()=>this.controller.abort())),__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_beginRequest).call(this),this._connected(),streaming_1.Stream.fromReadableStream(readableStream,this.controller));let chatId;for await(chunk of options)chatId&&chatId!==chunk.id&&this._addChatCompletion(__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(this)),__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_addChunk).call(this,chunk),chatId=chunk.id;if(options.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addChatCompletion(__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(this))}[(_ChatCompletionStream_params=new WeakMap,_ChatCompletionStream_choiceEventStates=new WeakMap,_ChatCompletionStream_currentChatCompletionSnapshot=new WeakMap,_ChatCompletionStream_instances=new WeakSet,_ChatCompletionStream_beginRequest=function(){this.ended||__classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,void 0,"f")},_ChatCompletionStream_getChoiceEventState=function(choice){var state=__classPrivateFieldGet(this,_ChatCompletionStream_choiceEventStates,"f")[choice.index];return state||(state={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},__classPrivateFieldGet(this,_ChatCompletionStream_choiceEventStates,"f")[choice.index]=state),state},_ChatCompletionStream_addChunk=function(chunk){if(!this.ended){var choice,completion=__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_accumulateChatCompletion).call(this,chunk);this._emit("chunk",chunk,completion);for(choice of chunk.choices){var toolCall,toolCallDelta,choiceSnapshot=completion.choices[choice.index],state=(null!=choice.delta.content&&"assistant"===choiceSnapshot.message?.role&&choiceSnapshot.message?.content&&(this._emit("content",choice.delta.content,choiceSnapshot.message.content),this._emit("content.delta",{delta:choice.delta.content,snapshot:choiceSnapshot.message.content,parsed:choiceSnapshot.message.parsed})),null!=choice.delta.refusal&&"assistant"===choiceSnapshot.message?.role&&choiceSnapshot.message?.refusal&&this._emit("refusal.delta",{delta:choice.delta.refusal,snapshot:choiceSnapshot.message.refusal}),null!=choice.logprobs?.content&&"assistant"===choiceSnapshot.message?.role&&this._emit("logprobs.content.delta",{content:choice.logprobs?.content,snapshot:choiceSnapshot.logprobs?.content??[]}),null!=choice.logprobs?.refusal&&"assistant"===choiceSnapshot.message?.role&&this._emit("logprobs.refusal.delta",{refusal:choice.logprobs?.refusal,snapshot:choiceSnapshot.logprobs?.refusal??[]}),__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot));choiceSnapshot.finish_reason&&(__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitContentDoneEvents).call(this,choiceSnapshot),null!=state.current_tool_call_index)&&__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitToolCallDoneEvent).call(this,choiceSnapshot,state.current_tool_call_index);for(toolCall of choice.delta.tool_calls??[])state.current_tool_call_index!==toolCall.index&&(__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitContentDoneEvents).call(this,choiceSnapshot),null!=state.current_tool_call_index)&&__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitToolCallDoneEvent).call(this,choiceSnapshot,state.current_tool_call_index),state.current_tool_call_index=toolCall.index;for(toolCallDelta of choice.delta.tool_calls??[]){var toolCallSnapshot=choiceSnapshot.message.tool_calls?.[toolCallDelta.index];toolCallSnapshot?.type&&("function"===toolCallSnapshot?.type?this._emit("tool_calls.function.arguments.delta",{name:toolCallSnapshot.function?.name,index:toolCallDelta.index,arguments:toolCallSnapshot.function.arguments,parsed_arguments:toolCallSnapshot.function.parsed_arguments,arguments_delta:toolCallDelta.function?.arguments??""}):toolCallSnapshot?.type)}}}},_ChatCompletionStream_emitToolCallDoneEvent=function(choiceSnapshot,toolCallIndex){var state=__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot);if(!state.done_tool_calls.has(toolCallIndex)){let toolCallSnapshot=choiceSnapshot.message.tool_calls?.[toolCallIndex];if(!toolCallSnapshot)throw new Error("no tool call snapshot");if(!toolCallSnapshot.type)throw new Error("tool call snapshot missing `type`");"function"===toolCallSnapshot.type?(state=__classPrivateFieldGet(this,_ChatCompletionStream_params,"f")?.tools?.find(tool=>"function"===tool.type&&tool.function.name===toolCallSnapshot.function.name),this._emit("tool_calls.function.arguments.done",{name:toolCallSnapshot.function.name,index:toolCallIndex,arguments:toolCallSnapshot.function.arguments,parsed_arguments:(0,parser_1.isAutoParsableTool)(state)?state.$parseRaw(toolCallSnapshot.function.arguments):state?.function.strict?JSON.parse(toolCallSnapshot.function.arguments):null})):toolCallSnapshot.type}},_ChatCompletionStream_emitContentDoneEvents=function(choiceSnapshot){var responseFormat,state=__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot);choiceSnapshot.message.content&&!state.content_done&&(state.content_done=!0,responseFormat=__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getAutoParseableResponseFormat).call(this),this._emit("content.done",{content:choiceSnapshot.message.content,parsed:responseFormat?responseFormat.$parseRaw(choiceSnapshot.message.content):null})),choiceSnapshot.message.refusal&&!state.refusal_done&&(state.refusal_done=!0,this._emit("refusal.done",{refusal:choiceSnapshot.message.refusal})),choiceSnapshot.logprobs?.content&&!state.logprobs_content_done&&(state.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:choiceSnapshot.logprobs.content})),choiceSnapshot.logprobs?.refusal&&!state.logprobs_refusal_done&&(state.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:choiceSnapshot.logprobs.refusal}))},_ChatCompletionStream_endRequest=function(){if(this.ended)throw new error_1.OpenAIError("stream has ended, this shouldn't happen");var snapshot=__classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f");if(snapshot)return __classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,void 0,"f"),__classPrivateFieldSet(this,_ChatCompletionStream_choiceEventStates,[],"f"),((snapshot,params)=>{let{id,choices,created,model,system_fingerprint,...rest}=snapshot,completion={...rest,id:id,choices:choices.map(({message,finish_reason,index,logprobs,...choiceRest})=>{if(!finish_reason)throw new error_1.OpenAIError("missing finish_reason for choice "+index);let{content=null,function_call,tool_calls,...messageRest}=message;var role=message.role;if(!role)throw new error_1.OpenAIError("missing role for choice "+index);if(function_call){var{arguments:args,name}=function_call;if(null==args)throw new error_1.OpenAIError("missing function_call.arguments for choice "+index);if(name)return{...choiceRest,message:{content:content,function_call:{arguments:args,name:name},role:role,refusal:message.refusal??null},finish_reason:finish_reason,index:index,logprobs:logprobs};throw new error_1.OpenAIError("missing function_call.name for choice "+index)}return tool_calls?{...choiceRest,index:index,finish_reason:finish_reason,logprobs:logprobs,message:{...messageRest,role:role,content:content,refusal:message.refusal??null,tool_calls:tool_calls.map((tool_call,i)=>{let{function:fn,type,id,...toolRest}=tool_call,{arguments:args,name,...fnRest}=fn||{};if(null==id)throw new error_1.OpenAIError(`missing choices[${index}].tool_calls[${i}].id
`+str(snapshot));if(null==type)throw new error_1.OpenAIError(`missing choices[${index}].tool_calls[${i}].type
`+str(snapshot));if(null==name)throw new error_1.OpenAIError(`missing choices[${index}].tool_calls[${i}].function.name
`+str(snapshot));if(null==args)throw new error_1.OpenAIError(`missing choices[${index}].tool_calls[${i}].function.arguments
`+str(snapshot));return{...toolRest,id:id,type:type,function:{...fnRest,name:name,arguments:args}}})}}:{...choiceRest,message:{...messageRest,content:content,role:role,refusal:message.refusal??null},finish_reason:finish_reason,index:index,logprobs:logprobs}}),created:created,model:model,object:"chat.completion",...system_fingerprint?{system_fingerprint:system_fingerprint}:{}};return(0,parser_1.maybeParseChatCompletion)(completion,params)})(snapshot,__classPrivateFieldGet(this,_ChatCompletionStream_params,"f"));throw new error_1.OpenAIError("request ended without sending any chunks")},_ChatCompletionStream_getAutoParseableResponseFormat=function(){var responseFormat=__classPrivateFieldGet(this,_ChatCompletionStream_params,"f")?.response_format;return(0,parser_1.isAutoParsableResponseFormat)(responseFormat)?responseFormat:null},_ChatCompletionStream_accumulateChatCompletion=function(chunk){let _a,_b,_c,_d,snapshot=__classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f"),{choices,...rest}=chunk;snapshot?Object.assign(snapshot,rest):snapshot=__classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,{...rest,choices:[]},"f");for(var{delta,finish_reason,index,logprobs=null,...other}of chunk.choices){let choice=snapshot.choices[index];if(choice=choice||(snapshot.choices[index]={finish_reason:finish_reason,index:index,message:{},logprobs:logprobs,...other}),logprobs)if(choice.logprobs){let{content,refusal,...rest}=logprobs;assertIsEmpty(rest),Object.assign(choice.logprobs,rest),content&&((_a=choice.logprobs).content??(_a.content=[]),choice.logprobs.content.push(...content)),refusal&&((_b=choice.logprobs).refusal??(_b.refusal=[]),choice.logprobs.refusal.push(...refusal))}else choice.logprobs=Object.assign({},logprobs);if(finish_reason&&(choice.finish_reason=finish_reason,__classPrivateFieldGet(this,_ChatCompletionStream_params,"f"))&&(0,parser_1.hasAutoParseableInput)(__classPrivateFieldGet(this,_ChatCompletionStream_params,"f"))){if("length"===finish_reason)throw new error_1.LengthFinishReasonError;if("content_filter"===finish_reason)throw new error_1.ContentFilterFinishReasonError}if(Object.assign(choice,other),delta){let{content,refusal,function_call,role,tool_calls,...rest}=delta;if(assertIsEmpty(rest),Object.assign(choice.message,rest),refusal&&(choice.message.refusal=(choice.message.refusal||"")+refusal),role&&(choice.message.role=role),function_call&&(choice.message.function_call?(function_call.name&&(choice.message.function_call.name=function_call.name),function_call.arguments&&((_c=choice.message.function_call).arguments??(_c.arguments=""),choice.message.function_call.arguments+=function_call.arguments)):choice.message.function_call=function_call),content&&(choice.message.content=(choice.message.content||"")+content,!choice.message.refusal)&&__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getAutoParseableResponseFormat).call(this)&&(choice.message.parsed=(0,parser_2.partialParse)(choice.message.content)),tool_calls){choice.message.tool_calls||(choice.message.tool_calls=[]);for(let{index,id,type,function:fn,...rest}of tool_calls){var tool_call=(_d=choice.message.tool_calls)[index]??(_d[index]={});Object.assign(tool_call,rest),id&&(tool_call.id=id),type&&(tool_call.type=type),fn&&(tool_call.function??(tool_call.function={name:fn.name??"",arguments:""})),fn?.name&&(tool_call.function.name=fn.name),fn?.arguments&&(tool_call.function.arguments+=fn.arguments,(0,parser_1.shouldParseToolCall)(__classPrivateFieldGet(this,_ChatCompletionStream_params,"f"),tool_call))&&(tool_call.function.parsed_arguments=(0,parser_2.partialParse)(tool_call.function.arguments))}}}}return snapshot},Symbol.asyncIterator)](){let pushQueue=[],readQueue=[],done=!1;return this.on("chunk",chunk=>{var reader=readQueue.shift();reader?reader.resolve(chunk):pushQueue.push(chunk)}),this.on("end",()=>{done=!0;for(var reader of readQueue)reader.resolve(void 0);readQueue.length=0}),this.on("abort",err=>{done=!0;for(var reader of readQueue)reader.reject(err);readQueue.length=0}),this.on("error",err=>{done=!0;for(var reader of readQueue)reader.reject(err);readQueue.length=0}),{next:async()=>pushQueue.length?{value:pushQueue.shift(),done:!1}:done?{value:void 0,done:!0}:new Promise((resolve,reject)=>readQueue.push({resolve:resolve,reject:reject})).then(chunk=>chunk?{value:chunk,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new streaming_1.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function str(x){return JSON.stringify(x)}function assertIsEmpty(){}exports.ChatCompletionStream=ChatCompletionStream},{"../_vendor/partial-json-parser/parser.js":11,"../error.js":13,"../lib/parser.js":29,"../streaming.js":64,"./AbstractChatCompletionRunner.js":20}],24:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ChatCompletionStreamingRunner=void 0;require=require("./ChatCompletionStream.js");class ChatCompletionStreamingRunner extends require.ChatCompletionStream{static fromReadableStream(stream){let runner=new ChatCompletionStreamingRunner(null);return runner._run(()=>runner._fromReadableStream(stream)),runner}static runFunctions(client,params,options){let runner=new ChatCompletionStreamingRunner(null),opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return runner._run(()=>runner._runFunctions(client,params,opts)),runner}static runTools(client,params,options){let runner=new ChatCompletionStreamingRunner(params),opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runTools"}};return runner._run(()=>runner._runTools(client,params,opts)),runner}}exports.ChatCompletionStreamingRunner=ChatCompletionStreamingRunner},{"./ChatCompletionStream.js":23}],25:[function(require,module,exports){var _EventStream_instances,_EventStream_connectedPromise,_EventStream_resolveConnectedPromise,_EventStream_rejectConnectedPromise,_EventStream_endPromise,_EventStream_resolveEndPromise,_EventStream_rejectEndPromise,_EventStream_listeners,_EventStream_ended,_EventStream_errored,_EventStream_aborted,_EventStream_catchingPromiseCreated,_EventStream_handleError,__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value;throw new TypeError("Cannot write private member to an object whose class did not declare it")},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver);throw new TypeError("Cannot read private member from an object whose class did not declare it")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventStream=void 0;let error_1=require("../error.js");exports.EventStream=class{constructor(){_EventStream_instances.add(this),this.controller=new AbortController,_EventStream_connectedPromise.set(this,void 0),_EventStream_resolveConnectedPromise.set(this,()=>{}),_EventStream_rejectConnectedPromise.set(this,()=>{}),_EventStream_endPromise.set(this,void 0),_EventStream_resolveEndPromise.set(this,()=>{}),_EventStream_rejectEndPromise.set(this,()=>{}),_EventStream_listeners.set(this,{}),_EventStream_ended.set(this,!1),_EventStream_errored.set(this,!1),_EventStream_aborted.set(this,!1),_EventStream_catchingPromiseCreated.set(this,!1),__classPrivateFieldSet(this,_EventStream_connectedPromise,new Promise((resolve,reject)=>{__classPrivateFieldSet(this,_EventStream_resolveConnectedPromise,resolve,"f"),__classPrivateFieldSet(this,_EventStream_rejectConnectedPromise,reject,"f")}),"f"),__classPrivateFieldSet(this,_EventStream_endPromise,new Promise((resolve,reject)=>{__classPrivateFieldSet(this,_EventStream_resolveEndPromise,resolve,"f"),__classPrivateFieldSet(this,_EventStream_rejectEndPromise,reject,"f")}),"f"),__classPrivateFieldGet(this,_EventStream_connectedPromise,"f").catch(()=>{}),__classPrivateFieldGet(this,_EventStream_endPromise,"f").catch(()=>{})}_run(executor){setTimeout(()=>{executor().then(()=>{this._emitFinal(),this._emit("end")},__classPrivateFieldGet(this,_EventStream_instances,"m",_EventStream_handleError).bind(this))},0)}_connected(){this.ended||(__classPrivateFieldGet(this,_EventStream_resolveConnectedPromise,"f").call(this),this._emit("connect"))}get ended(){return __classPrivateFieldGet(this,_EventStream_ended,"f")}get errored(){return __classPrivateFieldGet(this,_EventStream_errored,"f")}get aborted(){return __classPrivateFieldGet(this,_EventStream_aborted,"f")}abort(){this.controller.abort()}on(event,listener){return(__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]||(__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]=[])).push({listener:listener}),this}off(event,listener){var index,event=__classPrivateFieldGet(this,_EventStream_listeners,"f")[event];return event&&0<=(index=event.findIndex(l=>l.listener===listener))&&event.splice(index,1),this}once(event,listener){return(__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]||(__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]=[])).push({listener:listener,once:!0}),this}emitted(event){return new Promise((resolve,reject)=>{__classPrivateFieldSet(this,_EventStream_catchingPromiseCreated,!0,"f"),"error"!==event&&this.once("error",reject),this.once(event,resolve)})}async done(){__classPrivateFieldSet(this,_EventStream_catchingPromiseCreated,!0,"f"),await __classPrivateFieldGet(this,_EventStream_endPromise,"f")}_emit(event,...args){if(!__classPrivateFieldGet(this,_EventStream_ended,"f")){"end"===event&&(__classPrivateFieldSet(this,_EventStream_ended,!0,"f"),__classPrivateFieldGet(this,_EventStream_resolveEndPromise,"f").call(this));var error,listeners=__classPrivateFieldGet(this,_EventStream_listeners,"f")[event];if(listeners&&(__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]=listeners.filter(l=>!l.once),listeners.forEach(({listener})=>listener(...args))),"abort"===event)error=args[0],__classPrivateFieldGet(this,_EventStream_catchingPromiseCreated,"f")||listeners?.length||Promise.reject(error),__classPrivateFieldGet(this,_EventStream_rejectConnectedPromise,"f").call(this,error),__classPrivateFieldGet(this,_EventStream_rejectEndPromise,"f").call(this,error),this._emit("end");else if("error"===event){let error=args[0];__classPrivateFieldGet(this,_EventStream_catchingPromiseCreated,"f")||listeners?.length||Promise.reject(error),__classPrivateFieldGet(this,_EventStream_rejectConnectedPromise,"f").call(this,error),__classPrivateFieldGet(this,_EventStream_rejectEndPromise,"f").call(this,error),this._emit("end")}}}_emitFinal(){}},_EventStream_connectedPromise=new WeakMap,_EventStream_resolveConnectedPromise=new WeakMap,_EventStream_rejectConnectedPromise=new WeakMap,_EventStream_endPromise=new WeakMap,_EventStream_resolveEndPromise=new WeakMap,_EventStream_rejectEndPromise=new WeakMap,_EventStream_listeners=new WeakMap,_EventStream_ended=new WeakMap,_EventStream_errored=new WeakMap,_EventStream_aborted=new WeakMap,_EventStream_catchingPromiseCreated=new WeakMap,_EventStream_instances=new WeakSet,_EventStream_handleError=function(error){var openAIError;return __classPrivateFieldSet(this,_EventStream_errored,!0,"f"),(error=error instanceof Error&&"AbortError"===error.name?new error_1.APIUserAbortError:error)instanceof error_1.APIUserAbortError?(__classPrivateFieldSet(this,_EventStream_aborted,!0,"f"),this._emit("abort",error)):error instanceof error_1.OpenAIError?this._emit("error",error):error instanceof Error?((openAIError=new error_1.OpenAIError(error.message)).cause=error,this._emit("error",openAIError)):this._emit("error",new error_1.OpenAIError(String(error)))}},{"../error.js":13}],26:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ParsingToolFunction=exports.ParsingFunction=exports.isRunnableFunctionWithParse=void 0,exports.isRunnableFunctionWithParse=function(fn){return"function"==typeof fn.parse};exports.ParsingFunction=class{constructor(input){this.function=input.function,this.parse=input.parse,this.parameters=input.parameters,this.description=input.description,this.name=input.name}};exports.ParsingToolFunction=class{constructor(input){this.type="function",this.function=input}}},{}],27:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.allSettledWithThrow=void 0;exports.allSettledWithThrow=async promises=>{var promises=await Promise.allSettled(promises),rejected=promises.filter(result=>"rejected"===result.status);if(rejected.length){for(var result of rejected)console.error(result.reason);throw new Error(rejected.length+" promise(s) failed - see the above errors")}var values=[];for(let result of promises)"fulfilled"===result.status&&values.push(result.value);return values}},{}],28:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.isPresent=exports.isToolMessage=exports.isFunctionMessage=exports.isAssistantMessage=void 0;exports.isAssistantMessage=message=>"assistant"===message?.role,exports.isFunctionMessage=message=>"function"===message?.role;exports.isToolMessage=message=>"tool"===message?.role,exports.isPresent=function(obj){return null!=obj}},{}],29:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateInputTools=exports.hasAutoParseableInput=exports.shouldParseToolCall=exports.parseChatCompletion=exports.maybeParseChatCompletion=exports.isAutoParsableTool=exports.makeParseableTool=exports.isAutoParsableResponseFormat=exports.makeParseableResponseFormat=void 0;let error_1=require("../error.js");function isAutoParsableResponseFormat(response_format){return"auto-parseable-response-format"===response_format?.$brand}function isAutoParsableTool(tool){return"auto-parseable-tool"===tool?.$brand}function parseChatCompletion(completion,params){var choices=completion.choices.map(choice=>{if("length"===choice.finish_reason)throw new error_1.LengthFinishReasonError;if("content_filter"===choice.finish_reason)throw new error_1.ContentFilterFinishReasonError;return{...choice,message:{...choice.message,tool_calls:choice.message.tool_calls?.map(toolCall=>((params,toolCall)=>(params=params.tools?.find(inputTool=>inputTool.function?.name===toolCall.function.name),{...toolCall,function:{...toolCall.function,parsed_arguments:isAutoParsableTool(params)?params.$parseRaw(toolCall.function.arguments):params?.function.strict?JSON.parse(toolCall.function.arguments):null}}))(params,toolCall))??[],parsed:choice.message.content&&!choice.message.refusal?((params,content)=>"json_schema"!==params.response_format?.type||"json_schema"!==params.response_format?.type?null:"$parseRaw"in params.response_format?params.response_format.$parseRaw(content):JSON.parse(content))(params,choice.message.content):null}}});return{...completion,choices:choices}}function hasAutoParseableInput(params){return!!isAutoParsableResponseFormat(params.response_format)||(params.tools?.some(t=>isAutoParsableTool(t)||"function"===t.type&&!0===t.function.strict)??!1)}exports.makeParseableResponseFormat=function(response_format,parser){return response_format={...response_format},Object.defineProperties(response_format,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:parser,enumerable:!1}}),response_format},exports.isAutoParsableResponseFormat=isAutoParsableResponseFormat,exports.makeParseableTool=function(tool,{parser,callback}){return tool={...tool},Object.defineProperties(tool,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:parser,enumerable:!1},$callback:{value:callback,enumerable:!1}}),tool},exports.isAutoParsableTool=isAutoParsableTool,exports.maybeParseChatCompletion=function(completion,params){return params&&hasAutoParseableInput(params)?parseChatCompletion(completion,params):{...completion,choices:completion.choices.map(choice=>({...choice,message:{...choice.message,parsed:null,tool_calls:choice.message.tool_calls??[]}}))}},exports.parseChatCompletion=parseChatCompletion,exports.shouldParseToolCall=function(params,toolCall){return params&&(isAutoParsableTool(params=params.tools?.find(inputTool=>inputTool.function?.name===toolCall.function.name))||params?.function.strict)||!1},exports.hasAutoParseableInput=hasAutoParseableInput,exports.validateInputTools=function(tools){for(var tool of tools??[]){if("function"!==tool.type)throw new error_1.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${tool.type}\``);if(!0!==tool.function.strict)throw new error_1.OpenAIError(`The \`${tool.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}},{"../error.js":13}],30:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.CursorPage=exports.Page=void 0;require=require("./core.js");class Page extends require.AbstractPage{constructor(client,response,body,options){super(client,response,body,options),this.data=body.data||[],this.object=body.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}exports.Page=Page;class CursorPage extends require.AbstractPage{constructor(client,response,body,options){super(client,response,body,options),this.data=body.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){var info=this.nextPageInfo();return info?"params"in info?info.params:(info=Object.fromEntries(info.url.searchParams),Object.keys(info).length?info:null):null}nextPageInfo(){var data=this.getPaginatedItems();return data.length&&(data=data[data.length-1]?.id)?{params:{after:data}}:null}}exports.CursorPage=CursorPage},{"./core.js":12}],31:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.APIResource=void 0;exports.APIResource=class{constructor(client){this._client=client}}},{}],32:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Audio=void 0,require("../../resource.js"));let SpeechAPI=__importStar(require("./speech.js"));var speech_1=require("./speech.js");let TranscriptionsAPI=__importStar(require("./transcriptions.js"));var transcriptions_1=require("./transcriptions.js");let TranslationsAPI=__importStar(require("./translations.js"));__importStar=require("./translations.js");class Audio extends resource_1.APIResource{constructor(){super(...arguments),this.transcriptions=new TranscriptionsAPI.Transcriptions(this._client),this.translations=new TranslationsAPI.Translations(this._client),this.speech=new SpeechAPI.Speech(this._client)}}(exports.Audio=Audio).Transcriptions=transcriptions_1.Transcriptions,Audio.Translations=__importStar.Translations,Audio.Speech=speech_1.Speech},{"../../resource.js":31,"./speech.js":33,"./transcriptions.js":34,"./translations.js":35}],33:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Speech=void 0;require=require("../../resource.js");class Speech extends require.APIResource{create(body,options){return this._client.post("/audio/speech",{body:body,...options,__binaryResponse:!0})}}exports.Speech=Speech},{"../../resource.js":31}],34:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transcriptions=void 0,require("../../resource.js"));let Core=__importStar(require("../../core.js"));class Transcriptions extends resource_1.APIResource{create(body,options){return this._client.post("/audio/transcriptions",Core.multipartFormRequestOptions({body:body,...options}))}}exports.Transcriptions=Transcriptions},{"../../core.js":12,"../../resource.js":31}],35:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Translations=void 0,require("../../resource.js"));let Core=__importStar(require("../../core.js"));class Translations extends resource_1.APIResource{create(body,options){return this._client.post("/audio/translations",Core.multipartFormRequestOptions({body:body,...options}))}}exports.Translations=Translations},{"../../core.js":12,"../../resource.js":31}],36:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.BatchesPage=exports.Batches=void 0;var resource_1=require("../resource.js");let core_1=require("../core.js");require=require("../pagination.js");class Batches extends resource_1.APIResource{create(body,options){return this._client.post("/batches",{body:body,...options})}retrieve(batchId,options){return this._client.get("/batches/"+batchId,options)}list(query={},options){return(0,core_1.isRequestOptions)(query)?this.list({},query):this._client.getAPIList("/batches",BatchesPage,{query:query,...options})}cancel(batchId,options){return this._client.post(`/batches/${batchId}/cancel`,options)}}exports.Batches=Batches;class BatchesPage extends require.CursorPage{}exports.BatchesPage=BatchesPage,Batches.BatchesPage=BatchesPage},{"../core.js":12,"../pagination.js":30,"../resource.js":31}],37:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.AssistantsPage=exports.Assistants=void 0;var resource_1=require("../../resource.js");let core_1=require("../../core.js");require=require("../../pagination.js");class Assistants extends resource_1.APIResource{create(body,options){return this._client.post("/assistants",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(assistantId,options){return this._client.get("/assistants/"+assistantId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(assistantId,body,options){return this._client.post("/assistants/"+assistantId,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(query={},options){return(0,core_1.isRequestOptions)(query)?this.list({},query):this._client.getAPIList("/assistants",AssistantsPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(assistantId,options){return this._client.delete("/assistants/"+assistantId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.Assistants=Assistants;class AssistantsPage extends require.CursorPage{}exports.AssistantsPage=AssistantsPage,Assistants.AssistantsPage=AssistantsPage},{"../../core.js":12,"../../pagination.js":30,"../../resource.js":31}],38:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Beta=void 0,require("../../resource.js"));let AssistantsAPI=__importStar(require("./assistants.js")),ChatAPI=__importStar(require("./chat/chat.js"));var assistants_1=require("./assistants.js");let ThreadsAPI=__importStar(require("./threads/threads.js"));var threads_1=require("./threads/threads.js");let VectorStoresAPI=__importStar(require("./vector-stores/vector-stores.js"));__importStar=require("./vector-stores/vector-stores.js");require("./chat/chat.js");class Beta extends resource_1.APIResource{constructor(){super(...arguments),this.vectorStores=new VectorStoresAPI.VectorStores(this._client),this.chat=new ChatAPI.Chat(this._client),this.assistants=new AssistantsAPI.Assistants(this._client),this.threads=new ThreadsAPI.Threads(this._client)}}(exports.Beta=Beta).VectorStores=__importStar.VectorStores,Beta.VectorStoresPage=__importStar.VectorStoresPage,Beta.Assistants=assistants_1.Assistants,Beta.AssistantsPage=assistants_1.AssistantsPage,Beta.Threads=threads_1.Threads},{"../../resource.js":31,"./assistants.js":37,"./chat/chat.js":39,"./threads/threads.js":44,"./vector-stores/vector-stores.js":47}],39:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chat=void 0,require("../../../resource.js"));let CompletionsAPI=__importStar(require("./completions.js"));class Chat extends resource_1.APIResource{constructor(){super(...arguments),this.completions=new CompletionsAPI.Completions(this._client)}}exports.Chat=Chat,(Chat=>{Chat.Completions=CompletionsAPI.Completions})(Chat=exports.Chat||(exports.Chat={}))},{"../../../resource.js":31,"./completions.js":40}],40:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Completions=exports.ChatCompletionRunner=exports.ChatCompletionStream=exports.ParsingToolFunction=exports.ParsingFunction=exports.ChatCompletionStreamingRunner=void 0;var resource_1=require("../../../resource.js");let ChatCompletionRunner_1=require("../../../lib/ChatCompletionRunner.js"),ChatCompletionStreamingRunner_1=require("../../../lib/ChatCompletionStreamingRunner.js"),ChatCompletionStream_1=require("../../../lib/ChatCompletionStream.js"),parser_1=require("../../../lib/parser.js");var ChatCompletionStreamingRunner_2=require("../../../lib/ChatCompletionStreamingRunner.js"),RunnableFunction_1=(Object.defineProperty(exports,"ChatCompletionStreamingRunner",{enumerable:!0,get:function(){return ChatCompletionStreamingRunner_2.ChatCompletionStreamingRunner}}),require("../../../lib/RunnableFunction.js")),ChatCompletionStream_2=(Object.defineProperty(exports,"ParsingFunction",{enumerable:!0,get:function(){return RunnableFunction_1.ParsingFunction}}),Object.defineProperty(exports,"ParsingToolFunction",{enumerable:!0,get:function(){return RunnableFunction_1.ParsingToolFunction}}),require("../../../lib/ChatCompletionStream.js")),ChatCompletionRunner_2=(Object.defineProperty(exports,"ChatCompletionStream",{enumerable:!0,get:function(){return ChatCompletionStream_2.ChatCompletionStream}}),require("../../../lib/ChatCompletionRunner.js"));Object.defineProperty(exports,"ChatCompletionRunner",{enumerable:!0,get:function(){return ChatCompletionRunner_2.ChatCompletionRunner}});class Completions extends resource_1.APIResource{parse(body,options){return(0,parser_1.validateInputTools)(body.tools),this._client.chat.completions.create(body,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(completion=>(0,parser_1.parseChatCompletion)(completion,body))}runFunctions(body,options){return(body.stream?ChatCompletionStreamingRunner_1.ChatCompletionStreamingRunner:ChatCompletionRunner_1.ChatCompletionRunner).runFunctions(this._client,body,options)}runTools(body,options){return(body.stream?ChatCompletionStreamingRunner_1.ChatCompletionStreamingRunner:ChatCompletionRunner_1.ChatCompletionRunner).runTools(this._client,body,options)}stream(body,options){return ChatCompletionStream_1.ChatCompletionStream.createChatCompletion(this._client,body,options)}}exports.Completions=Completions},{"../../../lib/ChatCompletionRunner.js":22,"../../../lib/ChatCompletionStream.js":23,"../../../lib/ChatCompletionStreamingRunner.js":24,"../../../lib/RunnableFunction.js":26,"../../../lib/parser.js":29,"../../../resource.js":31}],41:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.MessagesPage=exports.Messages=void 0;var resource_1=require("../../../resource.js");let core_1=require("../../../core.js");require=require("../../../pagination.js");class Messages extends resource_1.APIResource{create(threadId,body,options){return this._client.post(`/threads/${threadId}/messages`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(threadId,messageId,options){return this._client.get(`/threads/${threadId}/messages/`+messageId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(threadId,messageId,body,options){return this._client.post(`/threads/${threadId}/messages/`+messageId,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,query={},options){return(0,core_1.isRequestOptions)(query)?this.list(threadId,{},query):this._client.getAPIList(`/threads/${threadId}/messages`,MessagesPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(threadId,messageId,options){return this._client.delete(`/threads/${threadId}/messages/`+messageId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.Messages=Messages;class MessagesPage extends require.CursorPage{}exports.MessagesPage=MessagesPage,Messages.MessagesPage=MessagesPage},{"../../../core.js":12,"../../../pagination.js":30,"../../../resource.js":31}],42:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.RunsPage=exports.Runs=void 0,require("../../../../resource.js"));let core_1=require("../../../../core.js"),AssistantStream_1=require("../../../../lib/AssistantStream.js"),core_2=require("../../../../core.js"),StepsAPI=__importStar(require("./steps.js"));__importStar=require("./steps.js"),require=require("../../../../pagination.js");class Runs extends resource_1.APIResource{constructor(){super(...arguments),this.steps=new StepsAPI.Steps(this._client)}create(threadId,params,options){let{include,...body}=params;return this._client.post(`/threads/${threadId}/runs`,{query:{include:include},body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers},stream:params.stream??!1})}retrieve(threadId,runId,options){return this._client.get(`/threads/${threadId}/runs/`+runId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(threadId,runId,body,options){return this._client.post(`/threads/${threadId}/runs/`+runId,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,query={},options){return(0,core_1.isRequestOptions)(query)?this.list(threadId,{},query):this._client.getAPIList(`/threads/${threadId}/runs`,RunsPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}cancel(threadId,runId,options){return this._client.post(`/threads/${threadId}/runs/${runId}/cancel`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}async createAndPoll(threadId,body,options){body=await this.create(threadId,body,options);return this.poll(threadId,body.id,options)}createAndStream(threadId,body,options){return AssistantStream_1.AssistantStream.createAssistantStream(threadId,this._client.beta.threads.runs,body,options)}async poll(threadId,runId,options){var headers={...options?.headers,"X-Stainless-Poll-Helper":"true"};for(options?.pollIntervalMs&&(headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString());;){var headerInterval,{data:run,response}=await this.retrieve(threadId,runId,{...options,headers:{...options?.headers,...headers}}).withResponse();switch(run.status){case"queued":case"in_progress":case"cancelling":let sleepInterval=5e3;options?.pollIntervalMs?sleepInterval=options.pollIntervalMs:(headerInterval=response.headers.get("openai-poll-after-ms"))&&(headerInterval=parseInt(headerInterval),isNaN(headerInterval)||(sleepInterval=headerInterval)),await(0,core_2.sleep)(sleepInterval);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return run}}}stream(threadId,body,options){return AssistantStream_1.AssistantStream.createAssistantStream(threadId,this._client.beta.threads.runs,body,options)}submitToolOutputs(threadId,runId,body,options){return this._client.post(`/threads/${threadId}/runs/${runId}/submit_tool_outputs`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers},stream:body.stream??!1})}async submitToolOutputsAndPoll(threadId,runId,body,options){runId=await this.submitToolOutputs(threadId,runId,body,options);return this.poll(threadId,runId.id,options)}submitToolOutputsStream(threadId,runId,body,options){return AssistantStream_1.AssistantStream.createToolAssistantStream(threadId,runId,this._client.beta.threads.runs,body,options)}}exports.Runs=Runs;class RunsPage extends require.CursorPage{}exports.RunsPage=RunsPage,Runs.RunsPage=RunsPage,Runs.Steps=__importStar.Steps,Runs.RunStepsPage=__importStar.RunStepsPage},{"../../../../core.js":12,"../../../../lib/AssistantStream.js":21,"../../../../pagination.js":30,"../../../../resource.js":31,"./steps.js":43}],43:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.RunStepsPage=exports.Steps=void 0;var resource_1=require("../../../../resource.js");let core_1=require("../../../../core.js");require=require("../../../../pagination.js");class Steps extends resource_1.APIResource{retrieve(threadId,runId,stepId,query={},options){return(0,core_1.isRequestOptions)(query)?this.retrieve(threadId,runId,stepId,{},query):this._client.get(`/threads/${threadId}/runs/${runId}/steps/`+stepId,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,runId,query={},options){return(0,core_1.isRequestOptions)(query)?this.list(threadId,runId,{},query):this._client.getAPIList(`/threads/${threadId}/runs/${runId}/steps`,RunStepsPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.Steps=Steps;class RunStepsPage extends require.CursorPage{}exports.RunStepsPage=RunStepsPage,Steps.RunStepsPage=RunStepsPage},{"../../../../core.js":12,"../../../../pagination.js":30,"../../../../resource.js":31}],44:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Threads=void 0,require("../../../resource.js"));let core_1=require("../../../core.js"),AssistantStream_1=require("../../../lib/AssistantStream.js"),MessagesAPI=__importStar(require("./messages.js"));var messages_1=require("./messages.js");let RunsAPI=__importStar(require("./runs/runs.js"));__importStar=require("./runs/runs.js");class Threads extends resource_1.APIResource{constructor(){super(...arguments),this.runs=new RunsAPI.Runs(this._client),this.messages=new MessagesAPI.Messages(this._client)}create(body={},options){return(0,core_1.isRequestOptions)(body)?this.create({},body):this._client.post("/threads",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(threadId,options){return this._client.get("/threads/"+threadId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(threadId,body,options){return this._client.post("/threads/"+threadId,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(threadId,options){return this._client.delete("/threads/"+threadId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}createAndRun(body,options){return this._client.post("/threads/runs",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers},stream:body.stream??!1})}async createAndRunPoll(body,options){body=await this.createAndRun(body,options);return this.runs.poll(body.thread_id,body.id,options)}createAndRunStream(body,options){return AssistantStream_1.AssistantStream.createThreadAssistantStream(body,this._client.beta.threads,options)}}(exports.Threads=Threads).Runs=__importStar.Runs,Threads.RunsPage=__importStar.RunsPage,Threads.Messages=messages_1.Messages,Threads.MessagesPage=messages_1.MessagesPage},{"../../../core.js":12,"../../../lib/AssistantStream.js":21,"../../../resource.js":31,"./messages.js":41,"./runs/runs.js":42}],45:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.VectorStoreFilesPage=exports.FileBatches=void 0;var resource_1=require("../../../resource.js");let core_1=require("../../../core.js"),core_2=require("../../../core.js"),Util_1=require("../../../lib/Util.js"),files_1=require("./files.js");Object.defineProperty(exports,"VectorStoreFilesPage",{enumerable:!0,get:function(){return files_1.VectorStoreFilesPage}});class FileBatches extends resource_1.APIResource{create(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}/file_batches`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,batchId,options){return this._client.get(`/vector_stores/${vectorStoreId}/file_batches/`+batchId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}cancel(vectorStoreId,batchId,options){return this._client.post(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/cancel`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}async createAndPoll(vectorStoreId,body,options){body=await this.create(vectorStoreId,body);return this.poll(vectorStoreId,body.id,options)}listFiles(vectorStoreId,batchId,query={},options){return(0,core_1.isRequestOptions)(query)?this.listFiles(vectorStoreId,batchId,{},query):this._client.getAPIList(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/files`,files_1.VectorStoreFilesPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}async poll(vectorStoreId,batchId,options){var headers={...options?.headers,"X-Stainless-Poll-Helper":"true"};for(options?.pollIntervalMs&&(headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString());;){var headerInterval,{data:batch,response}=await this.retrieve(vectorStoreId,batchId,{...options,headers:headers}).withResponse();switch(batch.status){case"in_progress":let sleepInterval=5e3;options?.pollIntervalMs?sleepInterval=options.pollIntervalMs:(headerInterval=response.headers.get("openai-poll-after-ms"))&&(headerInterval=parseInt(headerInterval),isNaN(headerInterval)||(sleepInterval=headerInterval)),await(0,core_2.sleep)(sleepInterval);break;case"failed":case"cancelled":case"completed":return batch}}}async uploadAndPoll(vectorStoreId,{files,fileIds=[]},options){if(null==files||0==files.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");var configuredConcurrency=options?.maxConcurrency??5,configuredConcurrency=Math.min(configuredConcurrency,files.length);let client=this._client;files=files.values();let allFileIds=[...fileIds];fileIds=Array(configuredConcurrency).fill(files).map(async function(iterator){for(var item of iterator){item=await client.files.create({file:item,purpose:"assistants"},options);allFileIds.push(item.id)}});return await(0,Util_1.allSettledWithThrow)(fileIds),this.createAndPoll(vectorStoreId,{file_ids:allFileIds})}}exports.FileBatches=FileBatches},{"../../../core.js":12,"../../../lib/Util.js":27,"../../../resource.js":31,"./files.js":46}],46:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.VectorStoreFilesPage=exports.Files=void 0;var resource_1=require("../../../resource.js");let core_1=require("../../../core.js");require=require("../../../pagination.js");class Files extends resource_1.APIResource{create(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}/files`,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,fileId,options){return this._client.get(`/vector_stores/${vectorStoreId}/files/`+fileId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(vectorStoreId,query={},options){return(0,core_1.isRequestOptions)(query)?this.list(vectorStoreId,{},query):this._client.getAPIList(`/vector_stores/${vectorStoreId}/files`,VectorStoreFilesPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(vectorStoreId,fileId,options){return this._client.delete(`/vector_stores/${vectorStoreId}/files/`+fileId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}async createAndPoll(vectorStoreId,body,options){body=await this.create(vectorStoreId,body,options);return this.poll(vectorStoreId,body.id,options)}async poll(vectorStoreId,fileId,options){var headers={...options?.headers,"X-Stainless-Poll-Helper":"true"};for(options?.pollIntervalMs&&(headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString());;){var headerInterval,fileResponse=await this.retrieve(vectorStoreId,fileId,{...options,headers:headers}).withResponse(),file=fileResponse.data;switch(file.status){case"in_progress":let sleepInterval=5e3;options?.pollIntervalMs?sleepInterval=options.pollIntervalMs:(headerInterval=fileResponse.response.headers.get("openai-poll-after-ms"))&&(headerInterval=parseInt(headerInterval),isNaN(headerInterval)||(sleepInterval=headerInterval)),await(0,core_1.sleep)(sleepInterval);break;case"failed":case"completed":return file}}}async upload(vectorStoreId,file,options){file=await this._client.files.create({file:file,purpose:"assistants"},options);return this.create(vectorStoreId,{file_id:file.id},options)}async uploadAndPoll(vectorStoreId,file,options){file=await this.upload(vectorStoreId,file,options);return this.poll(vectorStoreId,file.id,options)}}exports.Files=Files;class VectorStoreFilesPage extends require.CursorPage{}exports.VectorStoreFilesPage=VectorStoreFilesPage,Files.VectorStoreFilesPage=VectorStoreFilesPage},{"../../../core.js":12,"../../../pagination.js":30,"../../../resource.js":31}],47:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.VectorStoresPage=exports.VectorStores=void 0,require("../../../resource.js"));let core_1=require("../../../core.js"),FileBatchesAPI=__importStar(require("./file-batches.js"));var file_batches_1=require("./file-batches.js");let FilesAPI=__importStar(require("./files.js"));__importStar=require("./files.js"),require=require("../../../pagination.js");class VectorStores extends resource_1.APIResource{constructor(){super(...arguments),this.files=new FilesAPI.Files(this._client),this.fileBatches=new FileBatchesAPI.FileBatches(this._client)}create(body,options){return this._client.post("/vector_stores",{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,options){return this._client.get("/vector_stores/"+vectorStoreId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(vectorStoreId,body,options){return this._client.post("/vector_stores/"+vectorStoreId,{body:body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(query={},options){return(0,core_1.isRequestOptions)(query)?this.list({},query):this._client.getAPIList("/vector_stores",VectorStoresPage,{query:query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(vectorStoreId,options){return this._client.delete("/vector_stores/"+vectorStoreId,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.VectorStores=VectorStores;class VectorStoresPage extends require.CursorPage{}exports.VectorStoresPage=VectorStoresPage,VectorStores.VectorStoresPage=VectorStoresPage,VectorStores.Files=__importStar.Files,VectorStores.VectorStoreFilesPage=__importStar.VectorStoreFilesPage,VectorStores.FileBatches=file_batches_1.FileBatches},{"../../../core.js":12,"../../../pagination.js":30,"../../../resource.js":31,"./file-batches.js":45,"./files.js":46}],48:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chat=void 0,require("../../resource.js"));let CompletionsAPI=__importStar(require("./completions.js"));__importStar=require("./completions.js");class Chat extends resource_1.APIResource{constructor(){super(...arguments),this.completions=new CompletionsAPI.Completions(this._client)}}(exports.Chat=Chat).Completions=__importStar.Completions},{"../../resource.js":31,"./completions.js":49}],49:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Completions=void 0;require=require("../../resource.js");class Completions extends require.APIResource{create(body,options){return this._client.post("/chat/completions",{body:body,...options,stream:body.stream??!1})}}exports.Completions=Completions},{"../../resource.js":31}],50:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Completions=exports.Chat=void 0;var chat_1=require("./chat.js"),completions_1=(Object.defineProperty(exports,"Chat",{enumerable:!0,get:function(){return chat_1.Chat}}),require("./completions.js"));Object.defineProperty(exports,"Completions",{enumerable:!0,get:function(){return completions_1.Completions}})},{"./chat.js":48,"./completions.js":49}],51:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Completions=void 0;require=require("../resource.js");class Completions extends require.APIResource{create(body,options){return this._client.post("/completions",{body:body,...options,stream:body.stream??!1})}}exports.Completions=Completions},{"../resource.js":31}],52:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Embeddings=void 0;require=require("../resource.js");class Embeddings extends require.APIResource{create(body,options){return this._client.post("/embeddings",{body:body,...options})}}exports.Embeddings=Embeddings},{"../resource.js":31}],53:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.FileObjectsPage=exports.Files=void 0,require("../resource.js"));let core_1=require("../core.js"),core_2=require("../core.js"),error_1=require("../error.js"),Core=__importStar(require("../core.js"));__importStar=require("../pagination.js");class Files extends resource_1.APIResource{create(body,options){return this._client.post("/files",Core.multipartFormRequestOptions({body:body,...options}))}retrieve(fileId,options){return this._client.get("/files/"+fileId,options)}list(query={},options){return(0,core_1.isRequestOptions)(query)?this.list({},query):this._client.getAPIList("/files",FileObjectsPage,{query:query,...options})}del(fileId,options){return this._client.delete("/files/"+fileId,options)}content(fileId,options){return this._client.get(`/files/${fileId}/content`,{...options,__binaryResponse:!0})}retrieveContent(fileId,options){return this._client.get(`/files/${fileId}/content`,{...options,headers:{Accept:"application/json",...options?.headers}})}async waitForProcessing(id,{pollInterval=5e3,maxWait=18e5}={}){var TERMINAL_STATES=new Set(["processed","error","deleted"]),start=Date.now();let file=await this.retrieve(id);for(;!file.status||!TERMINAL_STATES.has(file.status);)if(await(0,core_2.sleep)(pollInterval),file=await this.retrieve(id),Date.now()-start>maxWait)throw new error_1.APIConnectionTimeoutError({message:`Giving up on waiting for file ${id} to finish processing after ${maxWait} milliseconds.`});return file}}exports.Files=Files;class FileObjectsPage extends __importStar.CursorPage{}exports.FileObjectsPage=FileObjectsPage,Files.FileObjectsPage=FileObjectsPage},{"../core.js":12,"../error.js":13,"../pagination.js":30,"../resource.js":31}],54:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.FineTuning=void 0,require("../../resource.js"));let JobsAPI=__importStar(require("./jobs/jobs.js"));__importStar=require("./jobs/jobs.js");class FineTuning extends resource_1.APIResource{constructor(){super(...arguments),this.jobs=new JobsAPI.Jobs(this._client)}}(exports.FineTuning=FineTuning).Jobs=__importStar.Jobs,FineTuning.FineTuningJobsPage=__importStar.FineTuningJobsPage,FineTuning.FineTuningJobEventsPage=__importStar.FineTuningJobEventsPage},{"../../resource.js":31,"./jobs/jobs.js":56}],55:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.FineTuningJobCheckpointsPage=exports.Checkpoints=void 0;var resource_1=require("../../../resource.js");let core_1=require("../../../core.js");require=require("../../../pagination.js");class Checkpoints extends resource_1.APIResource{list(fineTuningJobId,query={},options){return(0,core_1.isRequestOptions)(query)?this.list(fineTuningJobId,{},query):this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/checkpoints`,FineTuningJobCheckpointsPage,{query:query,...options})}}exports.Checkpoints=Checkpoints;class FineTuningJobCheckpointsPage extends require.CursorPage{}exports.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage,Checkpoints.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage},{"../../../core.js":12,"../../../pagination.js":30,"../../../resource.js":31}],56:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.FineTuningJobEventsPage=exports.FineTuningJobsPage=exports.Jobs=void 0,require("../../../resource.js"));let core_1=require("../../../core.js"),CheckpointsAPI=__importStar(require("./checkpoints.js"));__importStar=require("./checkpoints.js"),require=require("../../../pagination.js");class Jobs extends resource_1.APIResource{constructor(){super(...arguments),this.checkpoints=new CheckpointsAPI.Checkpoints(this._client)}create(body,options){return this._client.post("/fine_tuning/jobs",{body:body,...options})}retrieve(fineTuningJobId,options){return this._client.get("/fine_tuning/jobs/"+fineTuningJobId,options)}list(query={},options){return(0,core_1.isRequestOptions)(query)?this.list({},query):this._client.getAPIList("/fine_tuning/jobs",FineTuningJobsPage,{query:query,...options})}cancel(fineTuningJobId,options){return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/cancel`,options)}listEvents(fineTuningJobId,query={},options){return(0,core_1.isRequestOptions)(query)?this.listEvents(fineTuningJobId,{},query):this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/events`,FineTuningJobEventsPage,{query:query,...options})}}exports.Jobs=Jobs;class FineTuningJobsPage extends require.CursorPage{}exports.FineTuningJobsPage=FineTuningJobsPage;class FineTuningJobEventsPage extends require.CursorPage{}exports.FineTuningJobEventsPage=FineTuningJobEventsPage,Jobs.FineTuningJobsPage=FineTuningJobsPage,Jobs.FineTuningJobEventsPage=FineTuningJobEventsPage,Jobs.Checkpoints=__importStar.Checkpoints,Jobs.FineTuningJobCheckpointsPage=__importStar.FineTuningJobCheckpointsPage},{"../../../core.js":12,"../../../pagination.js":30,"../../../resource.js":31,"./checkpoints.js":55}],57:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Images=void 0,require("../resource.js"));let Core=__importStar(require("../core.js"));class Images extends resource_1.APIResource{createVariation(body,options){return this._client.post("/images/variations",Core.multipartFormRequestOptions({body:body,...options}))}edit(body,options){return this._client.post("/images/edits",Core.multipartFormRequestOptions({body:body,...options}))}generate(body,options){return this._client.post("/images/generations",{body:body,...options})}}exports.Images=Images},{"../core.js":12,"../resource.js":31}],58:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)},audio_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Uploads=exports.Moderations=exports.Models=exports.ModelsPage=exports.Images=exports.FineTuning=exports.Files=exports.FileObjectsPage=exports.Embeddings=exports.Completions=exports.Beta=exports.Batches=exports.BatchesPage=exports.Audio=void 0,__exportStar(require("./chat/index.js"),exports),__exportStar(require("./shared.js"),exports),require("./audio/audio.js")),batches_1=(Object.defineProperty(exports,"Audio",{enumerable:!0,get:function(){return audio_1.Audio}}),require("./batches.js")),beta_1=(Object.defineProperty(exports,"BatchesPage",{enumerable:!0,get:function(){return batches_1.BatchesPage}}),Object.defineProperty(exports,"Batches",{enumerable:!0,get:function(){return batches_1.Batches}}),require("./beta/beta.js")),completions_1=(Object.defineProperty(exports,"Beta",{enumerable:!0,get:function(){return beta_1.Beta}}),require("./completions.js")),embeddings_1=(Object.defineProperty(exports,"Completions",{enumerable:!0,get:function(){return completions_1.Completions}}),require("./embeddings.js")),files_1=(Object.defineProperty(exports,"Embeddings",{enumerable:!0,get:function(){return embeddings_1.Embeddings}}),require("./files.js")),fine_tuning_1=(Object.defineProperty(exports,"FileObjectsPage",{enumerable:!0,get:function(){return files_1.FileObjectsPage}}),Object.defineProperty(exports,"Files",{enumerable:!0,get:function(){return files_1.Files}}),require("./fine-tuning/fine-tuning.js")),images_1=(Object.defineProperty(exports,"FineTuning",{enumerable:!0,get:function(){return fine_tuning_1.FineTuning}}),require("./images.js")),models_1=(Object.defineProperty(exports,"Images",{enumerable:!0,get:function(){return images_1.Images}}),require("./models.js")),moderations_1=(Object.defineProperty(exports,"ModelsPage",{enumerable:!0,get:function(){return models_1.ModelsPage}}),Object.defineProperty(exports,"Models",{enumerable:!0,get:function(){return models_1.Models}}),require("./moderations.js")),uploads_1=(Object.defineProperty(exports,"Moderations",{enumerable:!0,get:function(){return moderations_1.Moderations}}),require("./uploads/uploads.js"));Object.defineProperty(exports,"Uploads",{enumerable:!0,get:function(){return uploads_1.Uploads}})},{"./audio/audio.js":32,"./batches.js":36,"./beta/beta.js":38,"./chat/index.js":50,"./completions.js":51,"./embeddings.js":52,"./files.js":53,"./fine-tuning/fine-tuning.js":54,"./images.js":57,"./models.js":59,"./moderations.js":60,"./shared.js":61,"./uploads/uploads.js":63}],59:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModelsPage=exports.Models=void 0;var resource_1=require("../resource.js"),require=require("../pagination.js");class Models extends resource_1.APIResource{retrieve(model,options){return this._client.get("/models/"+model,options)}list(options){return this._client.getAPIList("/models",ModelsPage,options)}del(model,options){return this._client.delete("/models/"+model,options)}}exports.Models=Models;class ModelsPage extends require.Page{}exports.ModelsPage=ModelsPage,Models.ModelsPage=ModelsPage},{"../pagination.js":30,"../resource.js":31}],60:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Moderations=void 0;require=require("../resource.js");class Moderations extends require.APIResource{create(body,options){return this._client.post("/moderations",{body:body,...options})}}exports.Moderations=Moderations},{"../resource.js":31}],61:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0})},{}],62:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Parts=void 0,require("../../resource.js"));let Core=__importStar(require("../../core.js"));class Parts extends resource_1.APIResource{create(uploadId,body,options){return this._client.post(`/uploads/${uploadId}/parts`,Core.multipartFormRequestOptions({body:body,...options}))}}exports.Parts=Parts},{"../../core.js":12,"../../resource.js":31}],63:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},resource_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Uploads=void 0,require("../../resource.js"));let PartsAPI=__importStar(require("./parts.js"));__importStar=require("./parts.js");class Uploads extends resource_1.APIResource{constructor(){super(...arguments),this.parts=new PartsAPI.Parts(this._client)}create(body,options){return this._client.post("/uploads",{body:body,...options})}cancel(uploadId,options){return this._client.post(`/uploads/${uploadId}/cancel`,options)}complete(uploadId,body,options){return this._client.post(`/uploads/${uploadId}/complete`,{body:body,...options})}}(exports.Uploads=Uploads).Parts=__importStar.Parts},{"../../resource.js":31,"./parts.js":62}],64:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.readableStreamAsyncIterable=exports._decodeChunks=exports._iterSSEMessages=exports.Stream=void 0;let index_1=require("./_shims/index.js"),error_1=require("./error.js"),line_1=require("./internal/decoders/line.js"),error_2=require("./error.js");class Stream{constructor(iterator,controller){this.iterator=iterator,this.controller=controller}static fromSSEResponse(response,controller){let consumed=!1;return new Stream(async function*(){if(consumed)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");let done=!(consumed=!0);try{for await(var sse of _iterSSEMessages(response,controller))if(!done)if(sse.data.startsWith("[DONE]"))done=!0;else if(null===sse.event){let data;try{data=JSON.parse(sse.data)}catch(e){throw console.error("Could not parse message into JSON:",sse.data),console.error("From chunk:",sse.raw),e}if(data&&data.error)throw new error_2.APIError(void 0,data.error,void 0,void 0);yield data}else{let data;try{data=JSON.parse(sse.data)}catch(e){throw console.error("Could not parse message into JSON:",sse.data),console.error("From chunk:",sse.raw),e}if("error"==sse.event)throw new error_2.APIError(void 0,data.error,data.message,void 0);yield{event:sse.event,data:data}}done=!0}catch(e){if(!(e instanceof Error&&"AbortError"===e.name))throw e}finally{done||controller.abort()}},controller)}static fromReadableStream(readableStream,controller){let consumed=!1;return new Stream(async function*(){if(consumed)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");let done=!(consumed=!0);try{for await(var line of async function*(){var chunk,lineDecoder=new line_1.LineDecoder;for await(chunk of readableStreamAsyncIterable(readableStream))for(var line of lineDecoder.decode(chunk))yield line;for(let line of lineDecoder.flush())yield line}())done||line&&(yield JSON.parse(line));done=!0}catch(e){if(!(e instanceof Error&&"AbortError"===e.name))throw e}finally{done||controller.abort()}},controller)}[Symbol.asyncIterator](){return this.iterator()}tee(){let left=[],right=[],iterator=this.iterator(),teeIterator=queue=>({next:()=>{var result;return 0===queue.length&&(result=iterator.next(),left.push(result),right.push(result)),queue.shift()}});return[new Stream(()=>teeIterator(left),this.controller),new Stream(()=>teeIterator(right),this.controller)]}toReadableStream(){let self=this,iter,encoder=new TextEncoder;return new index_1.ReadableStream({async start(){iter=self[Symbol.asyncIterator]()},async pull(ctrl){try{var{value,done}=await iter.next();if(done)return ctrl.close();var bytes=encoder.encode(JSON.stringify(value)+"\n");ctrl.enqueue(bytes)}catch(err){ctrl.error(err)}},async cancel(){await iter.return?.()}})}}async function*_iterSSEMessages(response,controller){if(!response.body)throw controller.abort(),new error_1.OpenAIError("Attempted to iterate over a response with no body");var sseChunk,sseDecoder=new SSEDecoder,lineDecoder=new line_1.LineDecoder;for await(sseChunk of async function*(iterator){let data=new Uint8Array;for await(var chunk of iterator)if(null!=chunk){var patternIndex,chunk=chunk instanceof ArrayBuffer?new Uint8Array(chunk):"string"==typeof chunk?(new TextEncoder).encode(chunk):chunk,newData=new Uint8Array(data.length+chunk.length);for(newData.set(data),newData.set(chunk,data.length),data=newData;-1!==(patternIndex=(buffer=>{for(let i=0;i<buffer.length-2;i++){if(10===buffer[i]&&10===buffer[i+1])return i+2;if(13===buffer[i]&&13===buffer[i+1])return i+2;if(13===buffer[i]&&10===buffer[i+1]&&i+3<buffer.length&&13===buffer[i+2]&&10===buffer[i+3])return i+4}return-1})(data));)yield data.slice(0,patternIndex),data=data.slice(patternIndex)}0<data.length&&(yield data)}(readableStreamAsyncIterable(response.body)))for(var line of lineDecoder.decode(sseChunk)){line=sseDecoder.decode(line);line&&(yield line)}for(let line of lineDecoder.flush()){let sse=sseDecoder.decode(line);sse&&(yield sse)}}exports.Stream=Stream,exports._iterSSEMessages=_iterSSEMessages;class SSEDecoder{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(line){var sse,index;if(!(line=line.endsWith("\r")?line.substring(0,line.length-1):line))return this.event||this.data.length?(sse={event:this.event,data:this.data.join("\n"),raw:this.chunks},this.event=null,this.data=[],this.chunks=[],sse):null;if(this.chunks.push(line),!line.startsWith(":")){sse=":";let[fieldname,,value]=-1===(index=(line=line).indexOf(sse))?[line,"",""]:[line.substring(0,index),sse,line.substring(index+sse.length)];value.startsWith(" ")&&(value=value.substring(1)),"event"===fieldname?this.event=value:"data"===fieldname&&this.data.push(value)}return null}}function readableStreamAsyncIterable(stream){if(stream[Symbol.asyncIterator])return stream;let reader=stream.getReader();return{async next(){try{var result=await reader.read();return result?.done&&reader.releaseLock(),result}catch(e){throw reader.releaseLock(),e}},async return(){var cancelPromise=reader.cancel();return reader.releaseLock(),await cancelPromise,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}exports._decodeChunks=function(chunks){var chunk,decoder=new line_1.LineDecoder,lines=[];for(chunk of chunks)lines.push(...decoder.decode(chunk));return lines},exports.readableStreamAsyncIterable=readableStreamAsyncIterable},{"./_shims/index.js":8,"./error.js":13,"./internal/decoders/line.js":15}],65:[function(require,module,exports){!function(Buffer){!function(){Object.defineProperty(exports,"__esModule",{value:!0}),exports.createForm=exports.multipartFormRequestOptions=exports.maybeMultipartFormRequestOptions=exports.isMultipartBody=exports.toFile=exports.isUploadable=exports.isBlobLike=exports.isFileLike=exports.isResponseLike=exports.fileFromPath=void 0;let index_1=require("./_shims/index.js");var index_2=require("./_shims/index.js");Object.defineProperty(exports,"fileFromPath",{enumerable:!0,get:function(){return index_2.fileFromPath}}),exports.isResponseLike=value=>null!=value&&"object"==typeof value&&"string"==typeof value.url&&"function"==typeof value.blob,exports.isFileLike=value=>null!=value&&"object"==typeof value&&"string"==typeof value.name&&"number"==typeof value.lastModified&&(0,exports.isBlobLike)(value),exports.isBlobLike=value=>null!=value&&"object"==typeof value&&"number"==typeof value.size&&"string"==typeof value.type&&"function"==typeof value.text&&"function"==typeof value.slice&&"function"==typeof value.arrayBuffer;async function toFile(value,name,options){var blob;return value=await value,(0,exports.isFileLike)(value)?value:(0,exports.isResponseLike)(value)?(blob=await value.blob(),name=name||(new URL(value.url).pathname.split(/[\\/]/).pop()??"unknown_file"),blob=(0,exports.isBlobLike)(blob)?[await blob.arrayBuffer()]:[blob],new index_1.File(blob,name,options)):(blob=await(async value=>{var parts=[];if("string"==typeof value||ArrayBuffer.isView(value)||value instanceof ArrayBuffer)parts.push(value);else if((0,exports.isBlobLike)(value))parts.push(await value.arrayBuffer());else{if(!isAsyncIterableIterator(value))throw new Error(`Unexpected data type: ${typeof value}; constructor: ${value?.constructor?.name}; props: `+(value=>`[${(value=Object.getOwnPropertyNames(value)).map(p=>`"${p}"`).join(", ")}]`)(value));for await(var chunk of value)parts.push(chunk)}return parts})(value),name=name||((value=>getStringFromMaybeBuffer(value.name)||getStringFromMaybeBuffer(value.filename)||getStringFromMaybeBuffer(value.path)?.split(/[\\/]/).pop())(value)??"unknown_file"),options?.type||"string"==typeof(value=blob[0]?.type)&&(options={...options,type:value}),new index_1.File(blob,name,options))}exports.isUploadable=value=>(0,exports.isFileLike)(value)||(0,exports.isResponseLike)(value)||(0,index_1.isFsReadStream)(value),exports.toFile=toFile;let getStringFromMaybeBuffer=x=>"string"==typeof x?x:void 0!==Buffer&&x instanceof Buffer?String(x):void 0,isAsyncIterableIterator=value=>null!=value&&"object"==typeof value&&"function"==typeof value[Symbol.asyncIterator];exports.isMultipartBody=body=>body&&"object"==typeof body&&body.body&&"MultipartBody"===body[Symbol.toStringTag],exports.maybeMultipartFormRequestOptions=async opts=>{var form;return hasUploadableValue(opts.body)?(form=await(0,exports.createForm)(opts.body),(0,index_1.getMultipartRequestOptions)(form,opts)):opts},exports.multipartFormRequestOptions=async opts=>{var form=await(0,exports.createForm)(opts.body);return(0,index_1.getMultipartRequestOptions)(form,opts)};exports.createForm=async body=>{let form=new index_1.FormData;return await Promise.all(Object.entries(body||{}).map(([key,value])=>addFormValue(form,key,value))),form};let hasUploadableValue=value=>{if((0,exports.isUploadable)(value))return!0;if(Array.isArray(value))return value.some(hasUploadableValue);if(value&&"object"==typeof value)for(var k in value)if(hasUploadableValue(value[k]))return!0;return!1},addFormValue=async(form,key,value)=>{if(void 0!==value){if(null==value)throw new TypeError(`Received null for "${key}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof value||"number"==typeof value||"boolean"==typeof value)form.append(key,String(value));else if((0,exports.isUploadable)(value)){var file=await toFile(value);form.append(key,file)}else if(Array.isArray(value))await Promise.all(value.map(entry=>addFormValue(form,key+"[]",entry)));else{if("object"!=typeof value)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${value} instead`);await Promise.all(Object.entries(value).map(([name,prop])=>addFormValue(form,key+`[${name}]`,prop)))}}}}.call(this)}.call(this,require("buffer").Buffer)},{"./_shims/index.js":8,buffer:3}],66:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.VERSION=void 0,exports.VERSION="4.73.1"},{}],67:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,module=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return(cachedSetTimeout=setTimeout)(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length)&&drainQueue()}function drainQueue(){if(!draining){for(var timeout=runTimeout(cleanUpNextTick),len=(draining=!0,queue.length);len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,!function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return(cachedClearTimeout=clearTimeout)(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}module.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},module.title="browser",module.browser=!0,module.env={},module.argv=[],module.version="",module.versions={},module.on=noop,module.addListener=noop,module.once=noop,module.off=noop,module.removeListener=noop,module.removeAllListeners=noop,module.emit=noop,module.prependListener=noop,module.prependOnceListener=noop,module.listeners=function(name){return[]},module.binding=function(name){throw new Error("process.binding is not supported")},module.cwd=function(){return"/"},module.chdir=function(dir){throw new Error("process.chdir is not supported")},module.umask=function(){return 0}},{}],68:[function(require,module,exports){var root,factory;root=this,factory=function(){var useCssAnimations,prefixes=["webkit","Moz","ms","O"],animations={};function createEl(tag,prop){var n,el=document.createElement(tag||"div");for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;i<n;i++)parent.appendChild(arguments[i]);return parent}function vendor(el,prop){var pp,i,s=el.style;if(void 0!==s[prop=prop.charAt(0).toUpperCase()+prop.slice(1)])return prop;for(i=0;i<prefixes.length;i++)if(void 0!==s[pp=prefixes[i]+prop])return pp}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var n,def=arguments[i];for(n in def)void 0===obj[n]&&(obj[n]=def[n])}return obj}function getColor(color,idx){return"string"==typeof color?color:color[idx%color.length]}var sheet,el,defaults={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};function Spinner(o){this.opts=merge(o||{},Spinner.defaults,defaults)}function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}return Spinner.defaults={},merge(Spinner.prototype,{spin:function(target){this.stop();var i,start,alpha,fps,f,ostep,astep,self=this,o=self.opts,el=self.el=createEl(null,{className:o.className});return css(el,{position:o.position,width:0,zIndex:o.zIndex,left:o.left,top:o.top}),target&&target.insertBefore(el,target.firstChild||null),el.setAttribute("role","progressbar"),self.lines(el,self.opts),useCssAnimations||(i=0,start=(o.lines-1)*(1-o.direction)/2,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines,function anim(){i++;for(var j=0;j<o.lines;j++)alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity),self.opacity(el,j*o.direction+start,alpha,o);self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))}()),self},stop:function(){var el=this.el;return el&&(clearTimeout(this.timeout),el.parentNode&&el.parentNode.removeChild(el),this.el=void 0),this},lines:function(el,o){var seg,i=0,start=(o.lines-1)*(1-o.direction)/2;function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.scale*(o.length+o.width)+"px",height:o.scale*o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.scale*o.radius+"px,0)",borderRadius:(o.corners*o.scale*o.width>>1)+"px"})}for(;i<o.lines;i++)seg=css(createEl(),{position:"absolute",top:1+~(o.scale*o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&((alpha,trail,i,lines)=>{var name=["opacity",trail,~~(100*alpha),i,lines].join("-"),i=.01+i/lines*100,lines=Math.max(1-(1-alpha)/trail*(100-i),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase();return animations[name]||(sheet.insertRule("@"+(prefix&&"-"+prefix+"-"||"")+"keyframes "+name+"{0%{opacity:"+lines+"}"+i+"%{opacity:"+alpha+"}"+(.01+i)+"%{opacity:1}"+(i+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+lines+"}}",sheet.cssRules.length),animations[name]=1),name})(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&ins(seg,css(fill("#000","0 0 4px #000"),{top:"2px"})),ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")));return el},opacity:function(el,i,val){i<el.childNodes.length&&(el.childNodes[i].style.opacity=val)}}),"undefined"!=typeof document&&(el=createEl("style",{type:"text/css"}),ins(document.getElementsByTagName("head")[0],el),sheet=el.sheet||el.styleSheet,!vendor(el=css(createEl("group"),{behavior:"url(#default#VML)"}),"transform")&&el.adj?(sheet.addRule(".spin-vml","behavior:url(#default#VML)"),Spinner.prototype.lines=function(el,o){var r=o.scale*(o.length+o.width),s=2*o.scale*r;function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}var i,margin=-(o.width+o.length)*o.scale*2+"px",g=css(grp(),{position:"absolute",top:margin,left:margin});function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.scale*o.width,left:o.scale*o.radius,top:-o.scale*o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)},Spinner.prototype.opacity=function(el,i,val,o){el=el.firstChild;o=o.shadow&&o.lines||0,el&&i+o<el.childNodes.length&&(el=(el=(el=el.childNodes[i+o])&&el.firstChild)&&el.firstChild)&&(el.opacity=val)}):useCssAnimations=vendor(el,"animation")),Spinner},"object"==typeof module&&module.exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):root.Spinner=factory()},{}]},{},[1]);
//# sourceMappingURL=scripts.min.js.map